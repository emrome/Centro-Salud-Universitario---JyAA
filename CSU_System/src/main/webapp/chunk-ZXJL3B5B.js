import{a as Ie}from"./chunk-5ZESFPG3.js";import{a as Te}from"./chunk-MPOD3TBQ.js";import{a as Oe}from"./chunk-ULAKRKGX.js";import{a as K}from"./chunk-T5CJBDVT.js";import{b as Ae,d as X,f as Y,h as Ee,k as $,l as U,m as H,q as J}from"./chunk-4ZEEV3KU.js";import{$a as g,Ba as ue,Ea as L,Fa as fe,Ja as h,K as F,L as de,Nb as Ce,Ob as j,Pb as G,Q as w,Qa as l,Sa as be,Sb as Z,Ua as o,V as pe,Va as n,Vb as Se,W as x,Wa as m,X as _,Xa as xe,Ya as _e,Za as oe,Zb as N,_a as y,_b as R,bc as W,da as ce,eb as ye,fa as me,fb as ve,g as le,ga as u,gb as B,hb as s,ia as ge,ib as f,jb as ae,lb as v,ma as he,mb as C,n as ne,nb as S,qb as D,ua as r,vb as z,ya as O}from"./chunk-ILAX3XGE.js";import{a as P,b as T,d as Pe,e as se}from"./chunk-FDERIQAA.js";var Le=["chart"],Me=(()=>{class i{constructor(){this.chart=u(),this.annotations=u(),this.colors=u(),this.dataLabels=u(),this.series=u(),this.stroke=u(),this.labels=u(),this.legend=u(),this.markers=u(),this.noData=u(),this.fill=u(),this.tooltip=u(),this.plotOptions=u(),this.responsive=u(),this.xaxis=u(),this.yaxis=u(),this.forecastDataPoints=u(),this.grid=u(),this.states=u(),this.title=u(),this.subtitle=u(),this.theme=u(),this.autoUpdateSeries=u(!0),this.chartReady=me(),this.chartInstance=ge(null),this.chartElement=ue.required("chart"),this.ngZone=w(ce),this.isBrowser=Se(w(he))}ngOnChanges(e){this.isBrowser&&this.ngZone.runOutsideAngular(()=>{le.schedule(()=>this.hydrate(e))})}ngOnDestroy(){this.destroy()}hydrate(e){if(this.autoUpdateSeries()&&Object.keys(e).filter(p=>p!=="series").length===0){this.updateSeries(this.series(),!0);return}this.createElement()}createElement(){return se(this,null,function*(){let{default:e}=yield import("./chunk-IOQYNPX3.js");window.ApexCharts||=e;let a={};["annotations","chart","colors","dataLabels","series","stroke","labels","legend","fill","tooltip","plotOptions","responsive","markers","noData","xaxis","yaxis","forecastDataPoints","grid","states","title","subtitle","theme"].forEach(c=>{let A=this[c]();A&&(a[c]=A)}),this.destroy();let d=this.ngZone.runOutsideAngular(()=>new e(this.chartElement().nativeElement,a));this.chartInstance.set(d),this.render(),this.chartReady.emit({chartObj:d})})}render(){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.render())}updateOptions(e,a,p,d){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.updateOptions(e,a,p,d))}updateSeries(e,a){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.updateSeries(e,a))}appendSeries(e,a){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.appendSeries(e,a))}appendData(e){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.appendData(e))}highlightSeries(e){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.highlightSeries(e))}toggleSeries(e){return this.ngZone.runOutsideAngular(()=>this.chartInstance()?.toggleSeries(e))}showSeries(e){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.showSeries(e))}hideSeries(e){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.hideSeries(e))}resetSeries(){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.resetSeries())}zoomX(e,a){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.zoomX(e,a))}toggleDataPointSelection(e,a){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.toggleDataPointSelection(e,a))}destroy(){this.chartInstance()?.destroy(),this.chartInstance.set(null)}setLocale(e){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.setLocale(e))}paper(){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.paper())}addXaxisAnnotation(e,a,p){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.addXaxisAnnotation(e,a,p))}addYaxisAnnotation(e,a,p){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.addYaxisAnnotation(e,a,p))}addPointAnnotation(e,a,p){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.addPointAnnotation(e,a,p))}removeAnnotation(e,a){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.removeAnnotation(e,a))}clearAnnotations(e){this.ngZone.runOutsideAngular(()=>this.chartInstance()?.clearAnnotations(e))}dataURI(e){return this.chartInstance()?.dataURI(e)}static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275cmp=L({type:i,selectors:[["apx-chart"]],viewQuery:function(a,p){a&1&&ye(p.chartElement,Le,5),a&2&&ve()},inputs:{chart:[1,"chart"],annotations:[1,"annotations"],colors:[1,"colors"],dataLabels:[1,"dataLabels"],series:[1,"series"],stroke:[1,"stroke"],labels:[1,"labels"],legend:[1,"legend"],markers:[1,"markers"],noData:[1,"noData"],fill:[1,"fill"],tooltip:[1,"tooltip"],plotOptions:[1,"plotOptions"],responsive:[1,"responsive"],xaxis:[1,"xaxis"],yaxis:[1,"yaxis"],forecastDataPoints:[1,"forecastDataPoints"],grid:[1,"grid"],states:[1,"states"],title:[1,"title"],subtitle:[1,"subtitle"],theme:[1,"theme"],autoUpdateSeries:[1,"autoUpdateSeries"]},outputs:{chartReady:"chartReady"},features:[pe],decls:2,vars:0,consts:[["chart",""]],template:function(a,p){a&1&&m(0,"div",null,0)},encapsulation:2,changeDetection:0})}}return i})();var we=(()=>{class i{static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275mod=fe({type:i})}static{this.\u0275inj=de({})}}return i})();var Q=class i{http=w(R);baseUrl=`${W.apiUrl}/analytics/demographics`;getSummary(t){let e=new N;return t.neighborhoodId!=null&&(e=e.set("neighborhoodId",String(t.neighborhoodId))),t.campaignId!=null&&(e=e.set("campaignId",String(t.campaignId))),t.zoneId!=null&&(e=e.set("zoneId",String(t.zoneId))),this.http.get(`${this.baseUrl}/summary`,{params:e}).pipe(ne(a=>Ve(a)))}getAgePyramid(t){let e=new N;return t.neighborhoodId!=null&&(e=e.set("neighborhoodId",String(t.neighborhoodId))),t.campaignId!=null&&(e=e.set("campaignId",String(t.campaignId))),t.zoneId!=null&&(e=e.set("zoneId",String(t.zoneId))),this.http.get(`${this.baseUrl}/age-pyramid`,{params:e}).pipe(ne(a=>ke(a)))}static \u0275fac=function(e){return new(e||i)};static \u0275prov=F({token:i,factory:i.\u0275fac,providedIn:"root"})};function k(i){return Array.isArray(i)?i.map(t=>({group:t.group??t.label??"N/D",count:Number(t.count??0)})):[]}function Ve(i){let t=k(i?.ageBuckets??i?.ages),e=k(i?.gender),a=k(i?.job),p=k(i?.education),d=k(i?.coverage);return{ageBuckets:t,gender:e,job:a,education:p,coverage:d}}function ke(i){return Array.isArray(i)?i.map(t=>({group:t.group??"N/D",subgroup:t.subgroup??t.subGroup??"N/D",count:Number(t.count??0)})):[]}var V=i=>[i];function Ze(i,t){if(i&1&&(o(0,"option",18),s(1),n()),i&2){let e=t.$implicit;l("ngValue",e.id),r(),f(e.name)}}function Re(i,t){if(i&1&&(o(0,"option",18),s(1),n()),i&2){let e=t.$implicit;l("ngValue",e.id),r(),f(e.name)}}function We(i,t){i&1&&(o(0,"p",43),s(1," Este barrio no tiene campa\xF1as asociadas. "),n())}function Xe(i,t){i&1&&(o(0,"div",44)(1,"button",45),s(2,"Cargando datos\u2026"),n()())}function Ye(i,t){if(i&1&&(o(0,"article",46)(1,"div",47)(2,"span",8),m(3,"i",48),n(),s(4),n()()),i&2){let e=g();r(4),ae("",e.error," ")}}function $e(i,t){if(i&1&&(o(0,"article",50)(1,"div",47),s(2),n()()),i&2){let e=g(2);r(2),ae("Este ",e.campaignId?"campa\xF1a":"barrio"," tiene encuestas asociadas.")}}function Ue(i,t){i&1&&(o(0,"article",51)(1,"div",47),s(2,"\u26A0 No hay informaci\xF3n disponible."),n()())}function He(i,t){if(i&1&&(o(0,"div"),h(1,$e,3,1,"article",49)(2,Ue,3,0,"ng-template",null,1,z),n()),i&2){let e=B(3),a=g();r(),l("ngIf",a.hasSurveys())("ngIfElse",e)}}function Je(i,t){if(i&1){let e=oe();o(0,"li")(1,"a",52),y("click",function(){let p=x(e).$implicit,d=g();return _(d.setView(p.key))}),o(2,"span",25),m(3,"i",53),n(),o(4,"span"),s(5),n()()()}if(i&2){let e=t.$implicit,a=g();be("is-active",a.selectedView===e.key),r(3),l("ngClass",e.icon),r(2),f(e.label)}}function Ke(i,t){if(i&1&&(o(0,"option",18),s(1),n()),i&2){let e=t.$implicit;l("ngValue",e.key),r(),f(e.label)}}function qe(i,t){if(i&1&&m(0,"apx-chart",59),i&2){let e=g(4);l("series",e.pyramidSeries)("chart",e.pyramidChart)("xaxis",e.pyramidXAxis)("yaxis",e.pyramidYAxis)("plotOptions",e.pyramidPlot)("dataLabels",e.pyramidDataLabels)("legend",e.pyramidLegend)("tooltip",e.pyramidTooltip)("annotations",e.pyramidAnnotations)("colors",e.chartColors.gradient)}}function Qe(i,t){if(i&1&&m(0,"apx-chart",60),i&2){let e=g(4);l("series",e.genderSeries)("chart",e.pieChart)("labels",e.genderLabels)("legend",e.pieLegend)("dataLabels",e.pieDataLabels)("tooltip",e.pieTooltip)("colors",e.chartColors.pie)}}function et(i,t){if(i&1&&m(0,"apx-chart",61),i&2){let e=g(4);l("series",e.configureBarSeries(e.jobData,"Empleo"))("chart",e.barChart)("xaxis",e.getXAxisConfig(e.jobLabels))("yaxis",e.getYAxisConfig("Empleo"))("plotOptions",e.barPlot)("dataLabels",e.barDataLabels)("colors",D(7,V,e.chartColors.primary))}}function tt(i,t){if(i&1&&m(0,"apx-chart",61),i&2){let e=g(4);l("series",e.configureBarSeries(e.eduData,"Educaci\xF3n"))("chart",e.barChart)("xaxis",e.getXAxisConfig(e.eduLabels))("yaxis",e.getYAxisConfig("Educaci\xF3n"))("plotOptions",e.barPlot)("dataLabels",e.barDataLabels)("colors",D(7,V,e.chartColors.secondary))}}function it(i,t){if(i&1&&m(0,"apx-chart",61),i&2){let e=g(4);l("series",e.configureBarSeries(e.covData,"Cobertura"))("chart",e.barChart)("xaxis",e.getXAxisConfig(e.covLabels))("yaxis",e.getYAxisConfig("Cobertura"))("plotOptions",e.barPlot)("dataLabels",e.barDataLabels)("colors",D(7,V,e.chartColors.accent))}}function nt(i,t){if(i&1&&(o(0,"div"),h(1,qe,1,10,"apx-chart",56)(2,Qe,1,7,"apx-chart",57)(3,et,1,9,"apx-chart",58)(4,tt,1,9,"apx-chart",58)(5,it,1,9,"apx-chart",58),n()),i&2){let e=g(3);r(),l("ngIf",e.pyramidSeries.length),r(),l("ngIf",e.genderSeries.length),r(),l("ngIf",e.jobData.length),r(),l("ngIf",e.eduData.length),r(),l("ngIf",e.covData.length)}}function ot(i,t){if(i&1&&(o(0,"div"),h(1,nt,6,5,"div",31),n()),i&2){let e=g(2);r(),l("ngIf",e.hasSurveys())}}function at(i,t){if(i&1&&(xe(0),m(1,"apx-chart",59),_e()),i&2){let e=g(3);r(),l("series",e.pyramidSeries)("chart",e.pyramidChart)("xaxis",e.pyramidXAxis)("yaxis",e.pyramidYAxis)("plotOptions",e.pyramidPlot)("dataLabels",e.pyramidDataLabels)("legend",e.pyramidLegend)("tooltip",e.pyramidTooltip)("annotations",e.pyramidAnnotations)("colors",e.chartColors.gradient)}}function rt(i,t){i&1&&(o(0,"p",66),s(1,"No hay datos para los filtros seleccionados."),n())}function st(i,t){if(i&1&&(o(0,"div",62)(1,"p",63)(2,"span",8),m(3,"i",64),n(),s(4," Pir\xE1mide poblacional (Edad \xD7 G\xE9nero) "),n(),h(5,at,2,10,"ng-container",42)(6,rt,2,0,"ng-template",null,2,z),o(8,"p",65),s(9," Masculino a la izquierda (valores negativos), femenino/otros a la derecha. "),n()()),i&2){let e=B(7),a=g(2);r(5),l("ngIf",a.pyramidSeries.length)("ngIfElse",e)}}function lt(i,t){if(i&1&&(o(0,"div",69)(1,"div",62)(2,"p",70)(3,"span",8),m(4,"i",71),n(),s(5," G\xE9nero / Identidad "),n(),o(6,"div",72),m(7,"apx-chart",73),n()()()),i&2){let e=g(3);r(7),l("chart",e.pieChart)("series",e.genderSeries)("labels",e.genderLabels)("colors",e.chartColors.pie)("dataLabels",e.pieDataLabels)("legend",e.pieLegend)("tooltip",e.pieTooltip)("plotOptions",e.piePlotOptions)}}function dt(i,t){if(i&1&&(o(0,"div",69)(1,"div",62)(2,"p",70)(3,"span",8),m(4,"i",74),n(),s(5," Tipo de empleo "),n(),m(6,"apx-chart",61),n()()),i&2){let e=g(3);r(6),l("series",e.configureBarSeries(e.jobData,"Empleos"))("chart",e.barChart)("xaxis",e.getXAxisConfig(e.jobLabels))("yaxis",e.getYAxisConfig("Cantidad"))("plotOptions",e.barPlot)("dataLabels",e.barDataLabels)("colors",D(7,V,e.chartColors.primary))}}function pt(i,t){if(i&1&&(o(0,"div",69)(1,"div",62)(2,"p",70)(3,"span",8),m(4,"i",75),n(),s(5," Nivel educativo "),n(),m(6,"apx-chart",61),n()()),i&2){let e=g(3);r(6),l("series",e.configureBarSeries(e.eduData,"Educaci\xF3n"))("chart",e.barChart)("xaxis",e.getXAxisConfig(e.eduLabels))("yaxis",e.getYAxisConfig("Cantidad"))("plotOptions",e.barPlot)("dataLabels",e.barDataLabels)("colors",D(7,V,e.chartColors.secondary))}}function ct(i,t){if(i&1&&(o(0,"div",67),h(1,lt,8,8,"div",68)(2,dt,7,9,"div",68)(3,pt,7,9,"div",68),n()),i&2){let e=g(2);r(),l("ngIf",e.showGender()),r(),l("ngIf",e.showJob()),r(),l("ngIf",e.showEdu())}}function mt(i,t){if(i&1&&(o(0,"div",62)(1,"p",70)(2,"span",8),m(3,"i",76),n(),s(4," Cobertura de salud "),n(),m(5,"apx-chart",61),n()),i&2){let e=g(2);r(5),l("series",e.configureBarSeries(e.covData,"Cobertura"))("chart",e.barChart)("xaxis",e.getXAxisConfig(e.covLabels))("yaxis",e.getYAxisConfig("Cantidad"))("plotOptions",e.barPlot)("dataLabels",e.barDataLabels)("colors",D(7,V,e.chartColors.accent))}}function gt(i,t){if(i&1&&(o(0,"div"),h(1,ot,2,1,"div",31)(2,st,10,2,"div",54)(3,ct,4,3,"div",55)(4,mt,6,9,"div",54),n()),i&2){let e=g();r(),l("ngIf",e.showAll()),r(),l("ngIf",e.showPyramid()),r(),l("ngIf",e.showGender()||e.showJob()||e.showEdu()),r(),l("ngIf",e.showCov())}}function ht(i,t){if(i&1&&(o(0,"tr")(1,"td"),s(2),n(),o(3,"td"),s(4),n()()),i&2){let e=t.$implicit;r(2),f(e.group),r(2),f(e.count)}}function ut(i,t){if(i&1&&(o(0,"tr")(1,"td"),s(2),n(),o(3,"td"),s(4),n()()),i&2){let e=t.$implicit;r(2),f(e.group),r(2),f(e.count)}}function ft(i,t){if(i&1&&(o(0,"tr")(1,"td"),s(2),n(),o(3,"td"),s(4),n()()),i&2){let e=t.$implicit;r(2),f(e.group),r(2),f(e.count)}}function bt(i,t){if(i&1&&(o(0,"tr")(1,"td"),s(2),n(),o(3,"td"),s(4),n()()),i&2){let e=t.$implicit;r(2),f(e.group),r(2),f(e.count)}}function xt(i,t){if(i&1&&(o(0,"div")(1,"div",77)(2,"p",78)(3,"span",8),m(4,"i",71),n(),s(5," G\xE9nero / Identidad "),n(),o(6,"table",79)(7,"thead")(8,"tr")(9,"th"),s(10,"Grupo"),n(),o(11,"th"),s(12,"Cantidad"),n()()(),o(13,"tbody"),h(14,ht,5,2,"tr",80),n()()(),o(15,"div",77)(16,"p",78)(17,"span",8),m(18,"i",74),n(),s(19," Tipo de empleo "),n(),o(20,"table",79)(21,"thead")(22,"tr")(23,"th"),s(24,"Grupo"),n(),o(25,"th"),s(26,"Cantidad"),n()()(),o(27,"tbody"),h(28,ut,5,2,"tr",80),n()()(),o(29,"div",77)(30,"p",78)(31,"span",8),m(32,"i",75),n(),s(33," Nivel educativo "),n(),o(34,"table",79)(35,"thead")(36,"tr")(37,"th"),s(38,"Grupo"),n(),o(39,"th"),s(40,"Cantidad"),n()()(),o(41,"tbody"),h(42,ft,5,2,"tr",80),n()()(),o(43,"div",62)(44,"p",78)(45,"span",8),m(46,"i",76),n(),s(47," Cobertura de salud "),n(),o(48,"table",79)(49,"thead")(50,"tr")(51,"th"),s(52,"Grupo"),n(),o(53,"th"),s(54,"Cantidad"),n()()(),o(55,"tbody"),h(56,bt,5,2,"tr",80),n()()()()),i&2){let e=g(2);r(14),l("ngForOf",e.summary.gender),r(14),l("ngForOf",e.summary.job),r(14),l("ngForOf",e.summary.education),r(14),l("ngForOf",e.summary.coverage)}}function _t(i,t){i&1&&(o(0,"div")(1,"div",81)(2,"span",8),m(3,"i",82),n(),s(4," La pir\xE1mide poblacional es una funcionalidad disponible solo en "),o(5,"strong"),s(6,"modo gr\xE1fico"),n(),s(7,". "),n()())}function yt(i,t){if(i&1&&(o(0,"tr")(1,"td"),s(2),n(),o(3,"td"),s(4),n()()),i&2){let e=t.$implicit;r(2),f(e.group),r(2),f(e.count)}}function vt(i,t){if(i&1&&(o(0,"div")(1,"div",62)(2,"p",78)(3,"span",8),m(4,"i",71),n(),s(5," G\xE9nero / Identidad "),n(),o(6,"table",79)(7,"thead")(8,"tr")(9,"th"),s(10,"Grupo"),n(),o(11,"th"),s(12,"Cantidad"),n()()(),o(13,"tbody"),h(14,yt,5,2,"tr",80),n()()()()),i&2){let e=g(2);r(14),l("ngForOf",e.summary.gender)}}function Ct(i,t){if(i&1&&(o(0,"tr")(1,"td"),s(2),n(),o(3,"td"),s(4),n()()),i&2){let e=t.$implicit;r(2),f(e.group),r(2),f(e.count)}}function St(i,t){if(i&1&&(o(0,"div")(1,"div",62)(2,"p",78)(3,"span",8),m(4,"i",74),n(),s(5," Tipo de empleo "),n(),o(6,"table",79)(7,"thead")(8,"tr")(9,"th"),s(10,"Grupo"),n(),o(11,"th"),s(12,"Cantidad"),n()()(),o(13,"tbody"),h(14,Ct,5,2,"tr",80),n()()()()),i&2){let e=g(2);r(14),l("ngForOf",e.summary.job)}}function At(i,t){if(i&1&&(o(0,"tr")(1,"td"),s(2),n(),o(3,"td"),s(4),n()()),i&2){let e=t.$implicit;r(2),f(e.group),r(2),f(e.count)}}function Et(i,t){if(i&1&&(o(0,"div")(1,"div",62)(2,"p",78)(3,"span",8),m(4,"i",75),n(),s(5," Nivel educativo "),n(),o(6,"table",79)(7,"thead")(8,"tr")(9,"th"),s(10,"Grupo"),n(),o(11,"th"),s(12,"Cantidad"),n()()(),o(13,"tbody"),h(14,At,5,2,"tr",80),n()()()()),i&2){let e=g(2);r(14),l("ngForOf",e.summary.education)}}function Ot(i,t){if(i&1&&(o(0,"tr")(1,"td"),s(2),n(),o(3,"td"),s(4),n()()),i&2){let e=t.$implicit;r(2),f(e.group),r(2),f(e.count)}}function It(i,t){if(i&1&&(o(0,"div")(1,"div",62)(2,"p",78)(3,"span",8),m(4,"i",76),n(),s(5," Cobertura de salud "),n(),o(6,"table",79)(7,"thead")(8,"tr")(9,"th"),s(10,"Grupo"),n(),o(11,"th"),s(12,"Cantidad"),n()()(),o(13,"tbody"),h(14,Ot,5,2,"tr",80),n()()()()),i&2){let e=g(2);r(14),l("ngForOf",e.summary.coverage)}}function Mt(i,t){if(i&1&&(o(0,"div"),h(1,xt,57,4,"div",31)(2,_t,8,0,"div",31)(3,vt,15,1,"div",31)(4,St,15,1,"div",31)(5,Et,15,1,"div",31)(6,It,15,1,"div",31),n()),i&2){let e=g();r(),l("ngIf",e.showAllTable()),r(),l("ngIf",e.selectedView==="pyramid"),r(),l("ngIf",e.showGenderTable()),r(),l("ngIf",e.showJobTable()),r(),l("ngIf",e.showEduTable()),r(),l("ngIf",e.showCovTable())}}function wt(i,t){i&1&&(o(0,"div",83),s(1," Ingres\xE1 un barrio o campa\xF1a y presion\xE1 "),o(2,"strong"),s(3,"Consultar"),n(),s(4,". "),n())}var ee=class i{constructor(t,e,a){this.analytics=t;this.neighborhoodService=e;this.campaignService=a}neighborhoodId;campaignId;neighborhoods=[];campaigns=[];filteredCampaigns=[];mode="chart";selectedView="all";ngOnInit(){let t=localStorage.getItem("analytics:view");this.selectedView=t??"all",this.loadCampaigns()}onNeighborhoodChange(t){t?this.filteredCampaigns=this.campaigns.filter(e=>e.neighborhoodId===t&&e.survey):this.filteredCampaigns=this.campaigns,this.campaignId&&!this.filteredCampaigns.some(e=>e.id===this.campaignId)&&(this.campaignId=void 0)}onCampaignChange(t){if(t){let e=this.campaigns.find(a=>a.id===t);this.campaignId=t,this.neighborhoodId=e?.neighborhoodId,this.onNeighborhoodChange(this.neighborhoodId)}else this.campaignId=void 0,this.neighborhoodId=void 0,this.onNeighborhoodChange(void 0)}hasSurveys(){return this.summary?this.summary.gender?.some(t=>t.count>0)||this.summary.job?.some(t=>t.count>0)||this.summary.education?.some(t=>t.count>0)||this.summary.coverage?.some(t=>t.count>0):!1}loadNeighborhoods(){this.neighborhoodService.getAll().subscribe({next:t=>{this.neighborhoods=t.filter(e=>this.campaigns.some(a=>a.neighborhoodId===e.id&&a.survey))},error:()=>this.error="Error cargando barrios"})}loadCampaigns(){this.campaignService.getAll().subscribe({next:t=>{this.campaigns=t.filter(e=>!!e.survey),this.filteredCampaigns=this.neighborhoodId?this.campaigns.filter(e=>e.neighborhoodId===this.neighborhoodId):this.campaigns,this.campaignId&&!this.filteredCampaigns.some(e=>e.id===this.campaignId)&&(this.campaignId=void 0),this.loadNeighborhoods()},error:()=>this.error="Error cargando campa\xF1as"})}loading=!1;error=null;summary;pyramidRows=[];chartColors={primary:"#4A9B8E",secondary:"#6BB6AB",accent:"#2E8B7B",light:"#A8D5CF",gradient:["#4A9B8E","#6BB6AB","#A8D5CF","#2E8B7B"],pie:["#4A9B8E","#6BB6AB","#A8D5CF","#2E8B7B","#7FC7BD","#5CAFFF"]};pyramidSeries=[];pyramidChart={type:"bar",height:420,stacked:!0,stackType:"normal",toolbar:{show:!1},animations:{enabled:!1}};pyramidAnnotations={xaxis:[{x:0,borderColor:"#cfd9d6",strokeDashArray:4}]};pyramidPlot={bar:{horizontal:!0,barHeight:"70%",borderRadius:4,borderRadiusApplication:"end"}};pyramidXAxis={categories:[],tickAmount:5,decimalsInFloat:0,labels:{formatter:t=>{let e=Number(t);if(Number.isNaN(e))return"";let a=Math.abs(Math.round(e)).toString();return e<0?`-${a}`:a}}};pyramidYAxis={title:{text:"Rangos de edad"}};pyramidDataLabels={enabled:!0,formatter:t=>`${Math.abs(Math.round(t))}`,style:{fontSize:"11px",fontWeight:600}};pyramidLegend={position:"top"};pyramidTooltip={theme:"light",y:{formatter:t=>`${Math.abs(t)} personas`}};genderLabels=[];genderSeries=[];pieChartBase={type:"pie",height:340,width:360,animations:{enabled:!1},toolbar:{show:!1}};get pieChart(){if(this.selectedView==="gender"){let t=typeof window<"u"&&window.innerWidth>=1024;return T(P({},this.pieChartBase),{height:t?520:420,width:t?600:380})}return this.pieChartBase}pieDataLabels={enabled:!0,formatter:t=>`${t.toFixed(1)}%`,style:{fontSize:"12px",fontWeight:600,colors:["#ffffff"]},dropShadow:{enabled:!1}};get pieLegend(){return this.selectedView==="gender"?{position:"right",horizontalAlign:"center"}:{position:"bottom"}}pieTooltip={theme:"light",y:{formatter:t=>`${t} personas`}};piePlotOptions={pie:{donut:{size:"0%"},expandOnClick:!0}};barChart={type:"bar",height:320,animations:{enabled:!1},toolbar:{show:!1}};barPlot={bar:{borderRadius:6,borderRadiusApplication:"end",columnWidth:"65%",colors:{backgroundBarColors:["#F4F6F8"],backgroundBarRadius:6}}};barDataLabels={enabled:!0,style:{fontSize:"11px",fontWeight:600,colors:["#ffffff"]},formatter:t=>t>0?`${t}`:"",offsetY:-2};jobLabels=[];jobData=[];eduLabels=[];eduData=[];covLabels=[];covData=[];views=[{key:"all",label:"Todos",icon:"fa-border-all"},{key:"pyramid",label:"Pir\xE1mide",icon:"fa-layer-group",color:"#2E8B7B"},{key:"gender",label:"G\xE9nero",icon:"fa-users",color:"#4A9B8E"},{key:"job",label:"Empleo",icon:"fa-briefcase",color:"#4A9B8E"},{key:"edu",label:"Educaci\xF3n",icon:"fa-graduation-cap",color:"#4A9B8E"},{key:"cov",label:"Cobertura",icon:"fa-heartbeat",color:"#4A9B8E"}];setView(t){this.selectedView=t,localStorage.setItem("analytics:view",t)}showPyramid(){return this.mode==="chart"&&this.selectedView==="pyramid"}showGender(){return this.mode==="chart"&&this.selectedView==="gender"}showJob(){return this.mode==="chart"&&this.selectedView==="job"}showEdu(){return this.mode==="chart"&&this.selectedView==="edu"}showCov(){return this.mode==="chart"&&this.selectedView==="cov"}showAll(){return this.mode==="chart"&&this.selectedView==="all"}showAllTable(){return this.mode==="table"&&this.selectedView==="all"}showGenderTable(){return this.mode==="table"&&this.selectedView==="gender"}showJobTable(){return this.mode==="table"&&this.selectedView==="job"}showEduTable(){return this.mode==="table"&&this.selectedView==="edu"}showCovTable(){return this.mode==="table"&&this.selectedView==="cov"}fetch(){if(this.error=null,this.neighborhoodId==null&&this.campaignId==null){this.error="Eleg\xED un barrio o una campa\xF1a.";return}this.loading=!0;let t={neighborhoodId:this.neighborhoodId,campaignId:this.campaignId};this.analytics.getSummary(t).subscribe({next:e=>{this.summary=e,this.buildFromSummary(e)},error:e=>{console.error(e),this.error="No se pudo cargar el resumen."},complete:()=>{this.loading=!1}}),this.analytics.getAgePyramid(t).subscribe({next:e=>{this.pyramidRows=e,this.buildPyramid(e)},error:e=>{console.error(e),this.error="No se pudo cargar la pir\xE1mide."}})}reset(){this.neighborhoodId=void 0,this.campaignId=void 0,this.summary=void 0,this.pyramidRows=[],this.pyramidSeries=[],this.pyramidXAxis=T(P({},this.pyramidXAxis),{categories:[],min:void 0,max:void 0}),this.genderLabels=[],this.genderSeries=[],this.jobLabels=[],this.jobData=[],this.eduLabels=[],this.eduData=[],this.covLabels=[],this.covData=[],this.error=null}buildFromSummary(t){this.genderLabels=t.gender.map(e=>e.group),this.genderSeries=t.gender.map(e=>e.count),this.jobLabels=t.job.map(e=>e.group),this.jobData=t.job.map(e=>e.count),this.eduLabels=t.education.map(e=>e.group),this.eduData=t.education.map(e=>e.count),this.covLabels=t.coverage.map(e=>e.group),this.covData=t.coverage.map(e=>e.count)}buildPyramid(t){if(!t?.length){this.pyramidSeries=[],this.pyramidXAxis=T(P({},this.pyramidXAxis),{categories:[]});return}let e=Array.from(new Set(t.map(b=>b.group))).sort(this.bucketSort),a=Array.from(new Set(t.map(b=>b.subgroup))),p=new Map;e.forEach(b=>p.set(b,new Map)),t.forEach(b=>p.get(b.group).set(b.subgroup,b.count));let d=b=>{let E=(b||"").trim().toLowerCase();return["var\xF3n","varon","hombre","masculino","m","male","masc"].some(M=>E.includes(M))};this.pyramidSeries=a.map(b=>({name:b,data:e.map(E=>{let M=p.get(E)?.get(b)??0;return d(b)?-M:M})}));let c=Math.max(1,...this.pyramidSeries.flatMap(b=>b.data.map(E=>Math.abs(Number(E))))),re=(b=>{let E=Math.pow(10,Math.floor(Math.log10(b))),M=b/E;return(M<=2?2:M<=5?5:10)*E})(c),De=e.length>=8?"70%":e.length>=5?"75%":e.length>=3?"80%":"60%";this.pyramidPlot={bar:T(P({},this.pyramidPlot.bar),{barHeight:De})},this.pyramidXAxis=T(P({},this.pyramidXAxis),{categories:e,min:-re,max:re,tickAmount:5})}bucketSort=(t,e)=>{let a=p=>{let d=p.match(/^(\d+)/);return d?parseInt(d[1],10):Number.MAX_SAFE_INTEGER};return a(t)-a(e)};configureBarSeries(t,e){return[{name:e,data:t}]}getXAxisConfig(t){return{categories:t,labels:{rotate:-45,maxHeight:60}}}getYAxisConfig(t){return{title:{text:t},decimalsInFloat:0}}static \u0275fac=function(e){return new(e||i)(O(Q),O(K),O(Ie))};static \u0275cmp=L({type:i,selectors:[["app-demographics-apex"]],decls:73,vars:18,consts:[["emptyState",""],["noSurveys",""],["noPyramidData",""],[1,"section"],[1,"container"],[1,"level","mb-4"],[1,"level-left"],[1,"title","is-4","has-text-weight-semibold",2,"color","#2E8B7B"],[1,"icon","mr-2"],[1,"fas","fa-chart-bar",2,"color","#4A9B8E"],[1,"box","filters-box"],[1,"columns","is-multiline","is-vcentered"],[1,"column","is-12-mobile","is-6-tablet","is-3-desktop"],[1,"field"],[1,"label","is-small"],[1,"control"],[1,"select","is-fullwidth"],[3,"ngModelChange","ngModel","disabled"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngModelChange","ngModel"],["class","help has-text-danger mt-1",4,"ngIf"],[1,"column","is-12-mobile","is-12-tablet","is-3-desktop","is-flex","is-justify-content-flex-end","is-align-items-flex-end"],[1,"buttons"],[1,"button","is-primary",2,"background","#4A9B8E","border-color","#4A9B8E",3,"click","disabled"],[1,"icon"],[1,"fas","fa-search"],[1,"button","is-light",3,"click"],[1,"fas","fa-times"],["class","has-text-centered py-3",4,"ngIf"],["class","message is-danger mt-2",4,"ngIf"],[4,"ngIf"],[1,"box","sticky-tabs",2,"padding",".75rem 1rem"],[1,"columns","is-multiline"],[1,"column","is-12-mobile","is-4-tablet","is-3-desktop"],["value","chart"],["value","table"],[1,"column","is-12-mobile","is-8-tablet","is-9-desktop"],[1,"tabs","is-toggle","is-toggle-rounded","is-fullwidth"],[3,"is-active",4,"ngFor","ngForOf"],[1,"box","is-hidden-desktop",2,"padding",".75rem 1rem"],[3,"ngModelChange","change","ngModel"],[4,"ngIf","ngIfElse"],[1,"help","has-text-danger","mt-1"],[1,"has-text-centered","py-3"],[1,"button","is-white","is-loading"],[1,"message","is-danger","mt-2"],[1,"message-body"],[1,"fas","fa-exclamation-triangle"],["class","message is-success is-small mt-2",4,"ngIf","ngIfElse"],[1,"message","is-success","is-small","mt-2"],[1,"message","is-warning","is-small","mt-2"],[3,"click"],[1,"fas",3,"ngClass"],["class","box",4,"ngIf"],["class","columns",4,"ngIf"],[3,"series","chart","xaxis","yaxis","plotOptions","dataLabels","legend","tooltip","annotations","colors",4,"ngIf"],[3,"series","chart","labels","legend","dataLabels","tooltip","colors",4,"ngIf"],[3,"series","chart","xaxis","yaxis","plotOptions","dataLabels","colors",4,"ngIf"],[3,"series","chart","xaxis","yaxis","plotOptions","dataLabels","legend","tooltip","annotations","colors"],[3,"series","chart","labels","legend","dataLabels","tooltip","colors"],[3,"series","chart","xaxis","yaxis","plotOptions","dataLabels","colors"],[1,"box"],[1,"title","is-5","mb-2"],[1,"fas","fa-layer-group",2,"color","#4A9B8E"],[1,"help","mt-2"],[1,"has-text-grey"],[1,"columns"],["class","column",4,"ngIf"],[1,"column"],[1,"title","is-6","mb-2"],[1,"fas","fa-users",2,"color","#4A9B8E"],[1,"is-flex","is-justify-content-center"],[3,"chart","series","labels","colors","dataLabels","legend","tooltip","plotOptions"],[1,"fas","fa-briefcase",2,"color","#4A9B8E"],[1,"fas","fa-graduation-cap",2,"color","#4A9B8E"],[1,"fas","fa-heartbeat",2,"color","#4A9B8E"],[1,"box","mb-4"],[1,"title","is-6","mb-3"],[1,"table","is-fullwidth","is-striped","is-hoverable","is-bordered"],[4,"ngFor","ngForOf"],[1,"notification","is-info","is-light"],[1,"fas","fa-info-circle"],[1,"has-text-centered","has-text-grey","py-6"]],template:function(e,a){if(e&1){let p=oe();o(0,"section",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"h1",7)(5,"span",8),m(6,"i",9),n(),s(7," Demograf\xEDa por barrio / campa\xF1a "),n()()(),o(8,"div",10)(9,"div",11)(10,"div",12)(11,"div",13)(12,"label",14),s(13,"Barrio"),n(),o(14,"div",15)(15,"div",16)(16,"select",17),S("ngModelChange",function(c){return x(p),C(a.neighborhoodId,c)||(a.neighborhoodId=c),_(c)}),y("ngModelChange",function(c){return x(p),_(a.onNeighborhoodChange(c))}),o(17,"option",18),s(18,"Todos"),n(),h(19,Ze,2,2,"option",19),n()()()()(),o(20,"div",12)(21,"div",13)(22,"label",14),s(23,"Campa\xF1a"),n(),o(24,"div",15)(25,"div",16)(26,"select",20),S("ngModelChange",function(c){return x(p),C(a.campaignId,c)||(a.campaignId=c),_(c)}),y("ngModelChange",function(c){return x(p),_(a.onCampaignChange(c))}),h(27,Re,2,2,"option",19),n()()(),h(28,We,2,0,"p",21),n()(),o(29,"div",22)(30,"div",23)(31,"button",24),y("click",function(){return x(p),_(a.fetch())}),o(32,"span",25),m(33,"i",26),n(),o(34,"span"),s(35,"Consultar"),n()(),o(36,"button",27),y("click",function(){return x(p),_(a.reset())}),o(37,"span",25),m(38,"i",28),n(),o(39,"span"),s(40,"Limpiar"),n()()()()(),h(41,Xe,3,0,"div",29)(42,Ye,5,1,"article",30)(43,He,4,2,"div",31),n(),o(44,"div",32)(45,"div",33)(46,"div",34)(47,"label",14),s(48,"Modo"),n(),o(49,"div",16)(50,"select",20),S("ngModelChange",function(c){return x(p),C(a.mode,c)||(a.mode=c),_(c)}),o(51,"option",35),s(52,"Gr\xE1fico"),n(),o(53,"option",36),s(54,"Tabla"),n()()()(),o(55,"div",37)(56,"label",14),s(57,"Vista"),n(),o(58,"div",38)(59,"ul"),h(60,Je,6,4,"li",39),n()()()()(),o(61,"div",40)(62,"div",13)(63,"label",14),s(64,"Vista"),n(),o(65,"div",15)(66,"div",16)(67,"select",41),S("ngModelChange",function(c){return x(p),C(a.selectedView,c)||(a.selectedView=c),_(c)}),y("change",function(){return x(p),_(a.setView(a.selectedView))}),h(68,Ke,2,2,"option",19),n()()()()(),h(69,gt,5,4,"div",42)(70,Mt,7,6,"div",31)(71,wt,5,0,"ng-template",null,0,z),n()()}if(e&2){let p=B(72);r(16),v("ngModel",a.neighborhoodId),l("disabled",!!a.campaignId),r(),l("ngValue",void 0),r(2),l("ngForOf",a.neighborhoods),r(7),v("ngModel",a.campaignId),r(),l("ngForOf",a.filteredCampaigns),r(),l("ngIf",a.neighborhoodId&&a.filteredCampaigns.length===0),r(3),l("disabled",a.loading||!a.neighborhoodId&&!a.campaignId),r(10),l("ngIf",a.loading),r(),l("ngIf",a.error),r(),l("ngIf",a.summary),r(7),v("ngModel",a.mode),r(10),l("ngForOf",a.views),r(7),v("ngModel",a.selectedView),r(),l("ngForOf",a.views),r(),l("ngIf",a.summary)("ngIfElse",p),r(),l("ngIf",a.mode==="table"&&a.summary)}},dependencies:[Z,Ce,j,G,J,U,H,$,X,Y,we,Me],styles:['@charset "UTF-8";.demographics-container[_ngcontent-%COMP%]{padding:24px;background:#f8fafc;min-height:100vh}.page-header[_ngcontent-%COMP%]{margin-bottom:24px}.page-title[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:600;color:#2e8b7b;margin:0;display:flex;align-items:center;gap:12px}.page-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#4a9b8e}.filter-section[_ngcontent-%COMP%]{margin-bottom:32px}.filter-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:24px;box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f;border:1px solid #e2e8f0}.filter-controls[_ngcontent-%COMP%]{display:flex;align-items:end;gap:20px;flex-wrap:wrap}.input-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;min-width:120px}.input-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:#374151;margin:0}.form-input[_ngcontent-%COMP%]{padding:10px 14px;border:2px solid #e5e7eb;border-radius:8px;font-size:.875rem;transition:all .2s ease;background:#fff}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#4a9b8e;box-shadow:0 0 0 3px #4a9b8e1a}.button-group[_ngcontent-%COMP%]{display:flex;gap:12px}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%]{padding:10px 20px;border-radius:8px;font-size:.875rem;font-weight:500;display:flex;align-items:center;gap:8px;cursor:pointer;transition:all .2s ease;border:2px solid transparent}.btn-primary[_ngcontent-%COMP%]{background:#4a9b8e;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background:#2e8b7b;transform:translateY(-1px);box-shadow:0 4px 8px #4a9b8e4d}.btn-secondary[_ngcontent-%COMP%]{background:#fff;color:#6b7280;border-color:#d1d5db}.btn-secondary[_ngcontent-%COMP%]:hover{background:#f9fafb;border-color:#9ca3af}.loading-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:12px;padding:40px;color:#4a9b8e;font-weight:500}.loading-spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid #e5e7eb;border-top:2px solid #4A9B8E;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.error-state[_ngcontent-%COMP%]{background:#fef2f2;border:1px solid #fecaca;color:#dc2626;padding:16px 20px;border-radius:8px;display:flex;align-items:center;gap:8px;font-weight:500}.charts-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.chart-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f;border:1px solid #e2e8f0;overflow:hidden;transition:all .2s ease}.chart-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 6px #00000012,0 2px 4px #0000000d;transform:translateY(-2px)}.pyramid-card[_ngcontent-%COMP%]{grid-column:1/-1}.chart-header[_ngcontent-%COMP%]{padding:20px 24px 0;border-bottom:1px solid #f1f5f9;margin-bottom:16px}.chart-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#1f2937;margin:0 0 20px;display:flex;align-items:center;gap:10px}.chart-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#4a9b8e;font-size:1.1rem}.chart-content[_ngcontent-%COMP%]{padding:0 24px 24px}.charts-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:24px}@media (max-width: 1200px){.charts-grid[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}@media (max-width: 768px){.demographics-container[_ngcontent-%COMP%]{padding:16px}.filter-controls[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.input-group[_ngcontent-%COMP%]{min-width:auto}.button-group[_ngcontent-%COMP%]{justify-content:center}.charts-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.chart-card[_ngcontent-%COMP%]{margin:0 -8px}}@media (max-width: 480px){.page-title[_ngcontent-%COMP%]{font-size:1.5rem}.filter-card[_ngcontent-%COMP%]{padding:16px;margin:0 -8px;border-radius:8px}.chart-content[_ngcontent-%COMP%]{padding:0 12px 16px}.chart-header[_ngcontent-%COMP%]{padding:16px 12px 0}}[_nghost-%COMP%]     .apexcharts-tooltip{background:#fff!important;border:1px solid #e5e7eb!important;box-shadow:0 10px 15px -3px #0000001a,0 4px 6px -2px #0000000d!important}[_nghost-%COMP%]     .apexcharts-tooltip-title{background:#f8fafc!important;border-color:#e5e7eb!important;color:#374151!important;font-weight:600!important}[_nghost-%COMP%]     .apexcharts-legend-text{color:#374151!important}[_nghost-%COMP%]     .apexcharts-gridline{stroke:#f1f5f9!important}[_nghost-%COMP%]     .apexcharts-text{fill:#6b7280!important}.tabs.is-toggle[_ngcontent-%COMP%]   li.is-active[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{background:#4a9b8e;border-color:#4a9b8e;color:#fff!important}.tabs.is-toggle[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{border-color:#6bb6ab}.filters-box[_ngcontent-%COMP%]{border-radius:12px;box-shadow:0 2px 10px #0000000d}.sticky-tabs[_ngcontent-%COMP%]{position:sticky;top:.75rem;z-index:5;border-radius:12px}.tabs[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{flex-wrap:wrap}.box[_ngcontent-%COMP%]{border-radius:12px}.filters-box[_ngcontent-%COMP%]{position:relative}.sticky-tabs[_ngcontent-%COMP%]{position:sticky;top:0;z-index:5;background:#fff;box-shadow:0 1px #0000000d}.apexcharts-canvas[_ngcontent-%COMP%]{margin:0 auto}']})};var I=Pe(Te());var te=class i{http=w(R);base=`${W.apiUrl}/analytics/map`;heatByDisease(t){let e=new N().set("neighborhoodId",String(t.neighborhoodId));return t.condition&&(e=e.set("condition",t.condition)),t.minAge!=null&&(e=e.set("minAge",String(t.minAge))),this.http.get(`${this.base}/heat-disease`,{params:e})}zoneCounts(t){let e=new N().set("neighborhoodId",String(t.neighborhoodId));return t.condition&&(e=e.set("condition",t.condition)),t.minAge!=null&&(e=e.set("minAge",String(t.minAge))),this.http.get(`${this.base}/zone-counts`,{params:e})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=F({token:i,factory:i.\u0275fac,providedIn:"root"})};function Pt(i,t){if(i&1&&(o(0,"option",4),s(1),n()),i&2){let e=t.$implicit;l("ngValue",e.id),r(),f(e.name)}}function Tt(i,t){if(i&1&&(o(0,"article",8),s(1),n()),i&2){let e=g();r(),f(e.error)}}var ie=class i{constructor(t,e,a){this.api=t;this.neighborhoodService=e;this.zoneService=a}neighborhoodId;condition="DIABETES";minAge;neighborhoods=[];zones=[];loading=!1;error=null;map;zonesLayer;ngOnInit(){this.initMap(),this.loadNeighborhoods()}ngOnDestroy(){this.map?.remove()}onNeighborhoodChange(){if(!this.neighborhoodId){this.clearLayers(),this.zones=[];return}this.zoneService.getByNeighborhood(this.neighborhoodId).subscribe({next:t=>{this.zones=t||[],this.fitToZones(),this.fetch()},error:t=>{this.zones=[],this.fetch()}})}fetch(){this.neighborhoodId&&(this.error=null,this.loading=!0,this.drawZones())}initMap(){this.map=I.map("map-analytics",{center:[-34.9,-57.95],zoom:12,zoomControl:!0}),I.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"\xA9 OpenStreetMap"}).addTo(this.map)}loadNeighborhoods(){this.neighborhoodService.getAll().subscribe({next:t=>{this.neighborhoods=t,!this.neighborhoodId&&this.neighborhoods.length&&(this.neighborhoodId=this.neighborhoods[0].id,this.onNeighborhoodChange())},error:t=>this.error="Error cargando barrios"})}drawZones(){!this.map||!this.neighborhoodId||this.api.zoneCounts({neighborhoodId:this.neighborhoodId,condition:this.condition,minAge:this.minAge}).subscribe({next:t=>{this.zonesLayer&&this.map.removeLayer(this.zonesLayer);let e=this.toZonesGeoJSON(t);this.zonesLayer=I.geoJSON(e,{style:a=>({color:"#2E8B7B",weight:1,fillOpacity:a?.properties?.count??0?.55:.15,fillColor:this.colorFor(a?.properties?.count??0,t)}),onEachFeature:(a,p)=>{let d=a.properties?.zoneName??"Zona",c=a.properties?.count??0;p.bindTooltip(`<strong>${d}</strong><br/>Casos: ${c}`,{sticky:!0})}}).addTo(this.map)},error:t=>this.error="No se pudo cargar el conteo por zona",complete:()=>this.loading=!1})}toZonesGeoJSON(t){let e=new Map(t.map(d=>[d.zoneId,d.count])),a=new Map(t.map(d=>[d.zoneId,d.zoneName])),p=[];for(let d of this.zones){let c=(d.coordinates||[]).map(A=>[A.lng,A.lat]);c.length&&(c.length&&(c[0][0]!==c[c.length-1][0]||c[0][1]!==c[c.length-1][1])&&c.push(c[0]),p.push({type:"Feature",properties:{zoneId:d.id,zoneName:a.get(d.id)??d.name,count:e.get(d.id)??0},geometry:{type:"Polygon",coordinates:[c]}}))}return{type:"FeatureCollection",features:p}}colorFor(t,e){let a=Math.max(1,...e.map(A=>A.count)),p=t/a,d=Math.floor(180+50*p),c=Math.floor(120+60*p);return`rgb(${c-60}, ${d}, ${c-20})`}fitToZones(){if(!this.map||!this.zones?.length)return;let t=[];this.zones.forEach(e=>(e.coordinates||[]).forEach(a=>t.push([a.lat,a.lng]))),t.length&&this.map.fitBounds(I.latLngBounds(t),{padding:[20,20]})}clearLayers(){this.zonesLayer&&this.map&&(this.map.removeLayer(this.zonesLayer),this.zonesLayer=void 0)}static \u0275fac=function(e){return new(e||i)(O(te),O(K),O(Oe))};static \u0275cmp=L({type:i,selectors:[["app-map-analytics"]],decls:50,vars:22,consts:[[1,"toolbar"],[1,"field"],[3,"ngModelChange","change","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"],["type","number","placeholder","18",3,"ngModelChange","change","ngModel"],["class","error",4,"ngIf"],["id","map-analytics",1,"map"],[1,"error"]],template:function(e,a){e&1&&(o(0,"div",0)(1,"div",1)(2,"label"),s(3,"Barrio"),n(),o(4,"select",2),S("ngModelChange",function(d){return C(a.neighborhoodId,d)||(a.neighborhoodId=d),d}),y("change",function(){return a.onNeighborhoodChange()}),h(5,Pt,2,2,"option",3),n()(),o(6,"div",1)(7,"label"),s(8,"Condici\xF3n"),n(),o(9,"select",2),S("ngModelChange",function(d){return C(a.condition,d)||(a.condition=d),d}),y("change",function(){return a.fetch()}),o(10,"option",4),s(11,"Ninguna"),n(),o(12,"option",4),s(13,"Diabetes"),n(),o(14,"option",4),s(15,"Hipertensi\xF3n"),n(),o(16,"option",4),s(17,"Cardiovasculares"),n(),o(18,"option",4),s(19,"Respiratorios"),n(),o(20,"option",4),s(21,"En la piel"),n(),o(22,"option",4),s(23,"En la vista"),n(),o(24,"option",4),s(25,"Gastrointestinales"),n(),o(26,"option",4),s(27,"Ginecol\xF3gicos"),n(),o(28,"option",4),s(29,"Alergias"),n(),o(30,"option",4),s(31,"En los huesos/articulaciones"),n(),o(32,"option",4),s(33,"Salud mental"),n(),o(34,"option",4),s(35,"Problemas de tiroides"),n(),o(36,"option",4),s(37,"Odontol\xF3gicos"),n(),o(38,"option",4),s(39,"C\xE1ncer"),n(),o(40,"option",4),s(41,"ITS"),n(),o(42,"option",4),s(43,"No sabe / N/C"),n()()(),o(44,"div",1)(45,"label"),s(46,"Edad m\xEDnima"),n(),o(47,"input",5),S("ngModelChange",function(d){return C(a.minAge,d)||(a.minAge=d),d}),y("change",function(){return a.fetch()}),n()()(),h(48,Tt,2,1,"article",6),m(49,"div",7)),e&2&&(r(4),v("ngModel",a.neighborhoodId),r(),l("ngForOf",a.neighborhoods),r(4),v("ngModel",a.condition),r(),l("ngValue","NONE"),r(2),l("ngValue","DIABETES"),r(2),l("ngValue","HYPERTENSION"),r(2),l("ngValue","CARDIOVASCULAR"),r(2),l("ngValue","RESPIRATORY"),r(2),l("ngValue","SKIN"),r(2),l("ngValue","VISION"),r(2),l("ngValue","GASTROINTESTINAL"),r(2),l("ngValue","GYNECOLOGICAL"),r(2),l("ngValue","ALLERGIES"),r(2),l("ngValue","BONES_JOINTS"),r(2),l("ngValue","MENTAL_HEALTH"),r(2),l("ngValue","THYROID"),r(2),l("ngValue","DENTAL"),r(2),l("ngValue","CANCER"),r(2),l("ngValue","STD"),r(2),l("ngValue","UNKNOWN"),r(5),v("ngModel",a.minAge),r(),l("ngIf",a.error))},dependencies:[Z,j,G,J,U,H,Ae,Ee,$,X,Y],styles:[".map-analytics[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.toolbar[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.75rem;align-items:flex-end}.toolbar[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.toolbar[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.8rem;color:#4a5568}.toolbar[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .toolbar[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{height:2.25rem;padding:0 .5rem;border:1px solid #d1d5db;border-radius:6px;background:#fff;min-width:12rem}.toolbar[_ngcontent-%COMP%]   .field.small[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{min-width:6rem}.toolbar[_ngcontent-%COMP%]   .view-switch[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-left:auto}.toolbar[_ngcontent-%COMP%]   .view-switch[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{height:2.25rem;padding:0 .9rem;border:1px solid #cbd5e1;background:#fff;color:#334155;border-radius:8px;cursor:pointer;transition:all .15s ease-in-out}.toolbar[_ngcontent-%COMP%]   .view-switch[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover{border-color:#94a3b8}.toolbar[_ngcontent-%COMP%]   .view-switch[_ngcontent-%COMP%]   .btn.active[_ngcontent-%COMP%]{background:#2e8b7b;border-color:#2e8b7b;color:#fff}.status[_ngcontent-%COMP%]{min-height:1.5rem}.status[_ngcontent-%COMP%]   .pill[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.4rem;padding:.2rem .6rem;border-radius:999px;font-size:.8rem}.status[_ngcontent-%COMP%]   .pill.loading[_ngcontent-%COMP%]{background:#eef2ff;color:#3730a3}.status[_ngcontent-%COMP%]   .pill.error[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}#map-analytics[_ngcontent-%COMP%]{width:100%;height:68vh;min-height:420px;border:1px solid #e5e7eb;border-radius:10px;overflow:hidden}@media (max-width: 768px){#map-analytics[_ngcontent-%COMP%]{height:60vh;min-height:360px}}"]})};var _i=[{path:"summary",component:ee},{path:"map",component:ie},{path:"",pathMatch:"full",redirectTo:"summary"}];export{_i as analyticsRoutes};
