import{a as H}from"./chunk-CWAPT7CM.js";import"./chunk-ENHWNVRG.js";import"./chunk-UPCSMMPA.js";import{a as D,b as F}from"./chunk-NDEZVH2L.js";import{a as $}from"./chunk-FSAZUVLP.js";import{a as O}from"./chunk-VVQ6IMPO.js";import"./chunk-AUN2S5OM.js";import{d as w,h as I,i as u}from"./chunk-OLTWCF2P.js";import{$a as c,Ea as y,Ja as g,Ob as C,Pb as M,Qa as m,Sb as A,Ua as r,Va as o,W as v,X as _,Xa as S,Ya as x,Za as E,_a as b,hb as s,ib as f,kb as k,t as U,ua as l,ya as h}from"./chunk-ILAX3XGE.js";import{a as L,b as T}from"./chunk-FDERIQAA.js";function j(i,t){if(i&1){let e=E();r(0,"div",6)(1,"div",7),b("click",function(){let d=v(e).$implicit,p=c();return _(p.goTo(d.link))}),r(2,"div",8)(3,"p",9),s(4),o(),r(5,"p",10),s(6),o()()()()}if(i&2){let e=t.$implicit;l(4),f(e.title),l(2),f(e.subtitle)}}var N=class i{constructor(t){this.router=t}cards=[{title:"Administradores",subtitle:"Gesti\xF3n de administradores",icon:"fa-bullhorn",link:u.Admin.Admins.List},{title:"Personal de Salud",subtitle:"Gesti\xF3n de personal de salud",icon:"fa-bullhorn",link:u.Admin.HealthStaff.List},{title:"Representantes de Organizaciones",subtitle:"Gesti\xF3n de representantes",icon:"fa-bullhorn",link:u.Admin.Representatives.List},{title:"Campa\xF1as",subtitle:"ABM y jornadas",icon:"fa-bullhorn",link:"/admin/campaigns"},{title:"Barrios",subtitle:"Gesti\xF3n y zonas",icon:"fa-map-marked-alt",link:u.Admin.Neighborhoods.List},{title:"Encuestadores",subtitle:"Altas y administraci\xF3n",icon:"fa-user-edit",link:u.Admin.Surveyors.List},{title:"Org. Sociales",subtitle:"ABM de organizaciones",icon:"fa-hand-holding-heart",link:"/admin/organizations"},{title:"Habilitaci\xF3n de usuarios",subtitle:"Aprobar y habilitar cuentas",icon:"fa-user-check",link:u.Admin.UserEnablement.List},{title:"An\xE1lisis de datos demograficos",subtitle:"Composici\xF3n del barrio",icon:"fa-chart-bar",link:u.Analytics.Summary},{title:"Mapa sanitario",subtitle:"Heatmap y conteo por zonas",icon:"fa-map",link:u.Analytics.Map}];goTo(t){this.router.navigate([t])}static \u0275fac=function(e){return new(e||i)(h(w))};static \u0275cmp=y({type:i,selectors:[["app-admin-dashboard"]],decls:8,vars:1,consts:[[1,"section"],[1,"container"],[1,"title"],[1,"subtitle"],[1,"columns","is-multiline"],["class","column is-one-third",4,"ngFor","ngForOf"],[1,"column","is-one-third"],[1,"card",2,"cursor","pointer",3,"click"],[1,"card-content"],[1,"title","is-5"],[1,"subtitle","is-6"]],template:function(e,n){e&1&&(r(0,"section",0)(1,"div",1)(2,"h1",2),s(3,"Panel de Administraci\xF3n"),o(),r(4,"p",3),s(5,"Bienvenido/a al sistema de gesti\xF3n integral del CSU"),o(),r(6,"div",4),g(7,j,7,2,"div",5),o()()()),e&2&&(l(7),m("ngForOf",n.cards))},dependencies:[A,C,I],encapsulation:2})};function G(i,t){i&1&&(r(0,"div"),s(1,"Cargando usuarios..."),o())}function q(i,t){if(i&1&&(r(0,"div",7),s(1),o()),i&2){let e=c();l(),f(e.errorMessage)}}function J(i,t){i&1&&(r(0,"div",8),s(1," No hay usuarios pendientes de habilitaci\xF3n. "),o())}function Q(i,t){i&1&&(r(0,"span",18),s(1,"Admin"),o())}function W(i,t){i&1&&(r(0,"span",19),s(1,"Salud"),o())}function X(i,t){i&1&&(r(0,"span",20),s(1,"Representante"),o())}function Y(i,t){if(i&1&&(S(0),s(1," Org.: "),r(2,"strong"),s(3),o(),x()),i&2){let e=c().$implicit;l(3),f(e.organizationName||"\u2014")}}function Z(i,t){if(i&1&&(S(0),s(1," Esp.: "),r(2,"strong"),s(3),o(),r(4,"span",21),s(5,"Mat.: "),r(6,"strong"),s(7),o()(),x()),i&2){let e=c().$implicit,n=c(2);l(3),f(n.getSpecialtyLabel(e.specialty)),l(4),f(e.license||"\u2014")}}function ee(i,t){if(i&1&&(S(0),s(1," Pos.: "),r(2,"strong"),s(3),o(),x()),i&2){let e=c().$implicit;l(3),f(e.positionInCSU||"\u2014")}}function te(i,t){if(i&1){let e=E();r(0,"tr")(1,"td"),g(2,Q,2,0,"span",13)(3,W,2,0,"span",14)(4,X,2,0,"span",15),o(),r(5,"td"),s(6),o(),r(7,"td"),s(8),o(),r(9,"td"),g(10,Y,4,1,"ng-container",3)(11,Z,8,2,"ng-container",3)(12,ee,4,1,"ng-container",3),o(),r(13,"td",11)(14,"button",16),b("click",function(){let d=v(e).$implicit,p=c(2);return _(p.enable(d))}),s(15," Habilitar "),o(),r(16,"button",17),b("click",function(){let d=v(e).$implicit,p=c(2);return _(p.delete(d))}),s(17," Eliminar "),o()()()}if(i&2){let e=t.$implicit,n=c(2);l(2),m("ngIf",e.type==="ADMIN"),l(),m("ngIf",e.type==="HEALTH"),l(),m("ngIf",e.type==="REP"),l(2),k("",e.lastName,", ",e.firstName,""),l(2),f(e.email),l(2),m("ngIf",e.type==="REP"),l(),m("ngIf",e.type==="HEALTH"),l(),m("ngIf",e.type==="ADMIN"),l(2),m("disabled",n.saving[n.rowKey(0,e)]),l(2),m("disabled",n.saving[n.rowKey(0,e)])}}function ie(i,t){if(i&1&&(r(0,"div",9)(1,"table",10)(2,"thead")(3,"tr")(4,"th"),s(5,"Tipo"),o(),r(6,"th"),s(7,"Nombre"),o(),r(8,"th"),s(9,"Email"),o(),r(10,"th"),s(11,"Detalle"),o(),r(12,"th",11),s(13,"Acciones"),o()()(),r(14,"tbody"),g(15,te,18,11,"tr",12),o()()()),i&2){let e=c();l(15),m("ngForOf",e.rows)("ngForTrackBy",e.rowKey)}}var R=class i{constructor(t,e,n){this.adminService=t;this.healthService=e;this.repService=n}loading=!0;saving={};errorMessage=null;rows=[];ngOnInit(){this.fetchAll()}fetchAll(){this.loading=!0,U({admins:this.adminService.getAll(),health:this.healthService.getAll(),reps:this.repService.getAll()}).subscribe({next:({admins:t,health:e,reps:n})=>{let d=(t||[]).filter(a=>!a.enabled&&!a.deleted).map(a=>({id:a.id,type:"ADMIN",firstName:a.firstName,lastName:a.lastName,email:a.email,dto:a,positionInCSU:a.positionInCSU??null})),p=(e||[]).filter(a=>!a.enabled&&!a.deleted).map(a=>({id:a.id,type:"HEALTH",firstName:a.firstName,lastName:a.lastName,email:a.email,dto:a,specialty:a.specialty??null,license:a.license??null})),z=(n||[]).filter(a=>!a.enabled&&!a.deleted).map(a=>({id:a.id,type:"REP",firstName:a.firstName,lastName:a.lastName,email:a.email,dto:a,organizationName:a.organizationName??null}));this.rows=[...d,...p,...z].sort((a,K)=>a.lastName.localeCompare(K.lastName)),this.loading=!1},error:()=>{this.errorMessage="Error cargando usuarios pendientes",this.loading=!1}})}enable(t){this.saving[this.rowKey(0,t)]=!0;let e=T(L({},t.dto),{enabled:!0}),n;t.type==="ADMIN"?n=this.adminService.update(t.id,e):t.type==="HEALTH"?n=this.healthService.update(t.id,e):n=this.repService.update(t.id,e),n.subscribe({next:()=>{this.rows=this.rows.filter(d=>d.id!==t.id||d.type!==t.type),this.saving[this.rowKey(0,t)]=!1},error:()=>{this.errorMessage="Error habilitando usuario",this.saving[this.rowKey(0,t)]=!1}})}delete(t){if(!confirm("\xBFEliminar este usuario?"))return;this.saving[this.rowKey(0,t)]=!0;let e;t.type==="ADMIN"?e=this.adminService.delete(t.id):t.type==="HEALTH"?e=this.healthService.delete(t.id):e=this.repService.delete(t.id),e.subscribe({next:()=>{this.rows=this.rows.filter(n=>n.id!==t.id||n.type!==t.type),this.saving[this.rowKey(0,t)]=!1},error:()=>{this.errorMessage="Error eliminando usuario",this.saving[this.rowKey(0,t)]=!1}})}getSpecialtyLabel(t){if(!t)return"\u2014";let e=O.find(n=>n.value===t);return e?e.label:t}rowKey=(t,e)=>`${e.type}_${e.id}`;static \u0275fac=function(e){return new(e||i)(h(D),h(F),h($))};static \u0275cmp=y({type:i,selectors:[["app-user-enable-list"]],decls:8,vars:4,consts:[[1,"section"],[1,"container"],[1,"title"],[4,"ngIf"],["class","notification is-danger",4,"ngIf"],["class","has-text-grey",4,"ngIf"],["class","table-container",4,"ngIf"],[1,"notification","is-danger"],[1,"has-text-grey"],[1,"table-container"],[1,"table","is-fullwidth","is-striped"],[1,"has-text-right"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","tag is-info",4,"ngIf"],["class","tag is-success",4,"ngIf"],["class","tag is-warning",4,"ngIf"],[1,"button","is-primary","is-small",3,"click","disabled"],[1,"button","is-danger","is-small","ml-2",3,"click","disabled"],[1,"tag","is-info"],[1,"tag","is-success"],[1,"tag","is-warning"],[1,"ml-2"]],template:function(e,n){if(e&1&&(r(0,"section",0)(1,"div",1)(2,"h1",2),s(3,"Habilitaci\xF3n de usuarios"),o(),g(4,G,2,0,"div",3)(5,q,2,1,"div",4)(6,J,2,0,"div",5)(7,ie,16,2,"div",6),o()()),e&2){let d,p;l(4),m("ngIf",n.loading),l(),m("ngIf",n.errorMessage),l(),m("ngIf",!n.loading&&((d=n.rows==null?null:n.rows.length)!==null&&d!==void 0?d:0)===0),l(),m("ngIf",!n.loading&&((p=n.rows==null?null:n.rows.length)!==null&&p!==void 0?p:0)>0)}},dependencies:[A,C,M,I],encapsulation:2})};var xe=[{path:"",component:H,children:[{path:"",component:N},{path:"neighborhoods",loadChildren:()=>import("./chunk-KV5BFV5W.js").then(i=>i.neighborhoodRoutes)},{path:"users",loadChildren:()=>import("./chunk-YQ3DQBRY.js").then(i=>i.adminUsersRoutes)},{path:"surveyors",loadChildren:()=>import("./chunk-5JIAF37R.js").then(i=>i.surveyorRoutes)},{path:"campaigns",loadChildren:()=>import("./chunk-JJB5R2XD.js").then(i=>i.adminCampaignsRoutes)},{path:"organizations",loadChildren:()=>import("./chunk-GFH3WUEC.js").then(i=>i.organizationRoutes)},{path:"users/enablement",component:R}]}];export{xe as adminRoutes};
