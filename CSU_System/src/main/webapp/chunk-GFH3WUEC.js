import{a as F}from"./chunk-T5CJBDVT.js";import{a as W}from"./chunk-FSAZUVLP.js";import{a as A}from"./chunk-N333UUWU.js";import{b as j,c as M,d as D,e as q,g as G,i as P,j as U,k as H,l as J,m as Y,p as K,r as Q}from"./chunk-4ZEEV3KU.js";import{b as B,d as N,h as T,i as _}from"./chunk-OLTWCF2P.js";import{$a as c,Ea as S,Ja as p,Ob as I,Pb as R,Qa as d,Sb as y,Ta as O,Ua as r,Va as o,W as h,Wa as w,X as b,Za as E,_a as u,hb as a,ib as f,jb as C,kb as L,t as $,ua as s,ya as g}from"./chunk-ILAX3XGE.js";import{a as v,b as x}from"./chunk-FDERIQAA.js";var k=[{value:"HEALTH",label:"Salud"},{value:"EDUCATION",label:"Educaci\xF3n"},{value:"SPORTS",label:"Deportes"},{value:"CULTURE",label:"Cultura"},{value:"SOCIAL_ASSISTANCE",label:"Asistencia social"}];function re(n,t){n&1&&(r(0,"div"),a(1,"Cargando organizaciones..."),o())}function ae(n,t){if(n&1&&(r(0,"div",8),a(1),o()),n&2){let e=c();s(),f(e.error)}}function se(n,t){n&1&&(r(0,"div",9),a(1," No se encontraron organizaciones. "),o())}function le(n,t){n&1&&a(0," \u2026 ")}function me(n,t){if(n&1&&a(0),n&2){let e=c().$implicit,i=c();C(" ",i.getRepresentativeCount(e.id)," ")}}function ce(n,t){n&1&&(r(0,"p",9),a(1,"Cargando representantes..."),o())}function de(n,t){if(n&1){let e=E();r(0,"li",18)(1,"div")(2,"span",22),a(3),o(),r(4,"span",9),a(5),o()(),r(6,"div",12)(7,"button",23),u("click",function(){let l=h(e).$implicit,m=c(4);return b(m.goToEditRepresentative(l.id))}),a(8,"Editar"),o(),r(9,"button",24),u("click",function(){let l=h(e).$implicit,m=c(3).$implicit,X=c();return b(X.deleteRepresentative(l.id,m.id))}),a(10,"Borrar"),o()()()}if(n&2){let e=t.$implicit;s(3),L("",e.firstName," ",e.lastName,""),s(2),C(" \u2014 ",e.email,"")}}function pe(n,t){if(n&1&&(r(0,"ul",20),p(1,de,11,3,"li",21),o()),n&2){let e=c(2).$implicit,i=c();s(),d("ngForOf",i.representatives[e.id])("ngForTrackBy",i.trackRep)}}function ge(n,t){n&1&&(r(0,"p",9),a(1,"No hay representantes asociados."),o())}function ue(n,t){if(n&1){let e=E();r(0,"div",17)(1,"div",18)(2,"p",9),a(3,"Representantes:"),o(),r(4,"div",12)(5,"button",19),u("click",function(){h(e);let l=c().$implicit,m=c();return b(m.goToNewRepresentative(l.id))}),a(6," + Nuevo representante "),o()()(),p(7,ce,2,0,"p",9)(8,pe,2,2,"ul",20)(9,ge,2,0,"p",9),o()}if(n&2){let e=c().$implicit,i=c();s(7),O(i.loadingRepresentatives[e.id]?7:i.representatives[e.id]&&i.representatives[e.id].length?8:9)}}function ve(n,t){if(n&1){let e=E();r(0,"div",10)(1,"div",11)(2,"strong"),a(3),o(),r(4,"div",12)(5,"button",13),u("click",function(){let l=h(e).$implicit,m=c();return b(m.toggleRepresentatives(l.id))}),a(6," Representantes "),r(7,"span",14),p(8,le,1,0)(9,me,1,1),o()(),r(10,"button",15),u("click",function(){let l=h(e).$implicit,m=c();return b(m.goToEditOrganization(l.id))}),a(11,"Editar"),o(),r(12,"button",16),u("click",function(){let l=h(e).$implicit,m=c();return b(m.deleteOrganization(l.id))}),a(13,"Borrar"),o()()(),r(14,"p",9),a(15),o(),r(16,"p",9),a(17),o(),p(18,ue,10,1,"div",17),o()}if(n&2){let e=t.$implicit,i=c();s(3),f(e.name),s(5),O(i.loadingRepresentatives[e.id]?8:9),s(7),L(" Actividad: ",i.getActivityLabel(e.mainActivity)," | Barrio: ",i.neighborhoods[e.neighborhoodId]||"\u2014"," "),s(2),C("Direcci\xF3n: ",e.address||"\u2014",""),s(),O(i.expandedOrganizationId===e.id?18:-1)}}var V=class n{constructor(t,e,i,l){this.organizationService=t;this.neighborhoodService=e;this.representativeService=i;this.router=l}organizations=[];neighborhoods={};representatives={};representativeCounts={};loadingRepresentatives={};expandedOrganizationId=null;loading=!0;error=null;ngOnInit(){this.fetchOrganizations(),this.fetchNeighborhoods()}fetchOrganizations(){this.loading=!0,this.organizationService.getAll().subscribe({next:t=>{this.organizations=t,this.loading=!1,this.loadRepresentativeCounts()},error:()=>{this.error="Error cargando organizaciones",this.loading=!1}})}loadRepresentativeCounts(){let t=this.organizations.map(e=>this.representativeService.getByOrganization(e.id));t.length!==0&&$(t).subscribe({next:e=>{e.forEach((i,l)=>{let m=this.organizations[l].id;this.representativeCounts[m]=i&&i.length?i.length:0})},error:()=>{this.organizations.forEach(e=>{this.representativeCounts[e.id]=0})}})}fetchNeighborhoods(){this.neighborhoodService.getAll().subscribe({next:t=>{for(let e of t)e.id!=null&&(this.neighborhoods[e.id]=e.name)}})}toggleRepresentatives(t){if(this.expandedOrganizationId===t){this.expandedOrganizationId=null;return}this.expandedOrganizationId=t,this.representatives[t]||this.refreshRepresentatives(t)}refreshRepresentatives(t){this.loadingRepresentatives=x(v({},this.loadingRepresentatives),{[t]:!0}),this.representativeService.getByOrganization(t).subscribe({next:e=>{this.representatives=x(v({},this.representatives),{[t]:e||[]}),this.representativeCounts[t]=e&&e.length?e.length:0,this.loadingRepresentatives=x(v({},this.loadingRepresentatives),{[t]:!1})},error:()=>{this.loadingRepresentatives=x(v({},this.loadingRepresentatives),{[t]:!1}),this.error="Error cargando representantes"}})}goToNewOrganization(){this.router.navigate([_.Admin.Organizations.New])}goToEditOrganization(t){this.router.navigate([_.Admin.Organizations.Edit(t)])}goToNewRepresentative(t){this.router.navigate([_.Admin.Representatives.New],{queryParams:{organizationId:t}})}goToEditRepresentative(t){this.router.navigate([_.Admin.Representatives.Edit(t)])}deleteRepresentative(t,e){confirm("\xBFEliminar representante?")&&this.representativeService.delete(t).subscribe({next:()=>{let l=(this.representatives[e]||[]).filter(m=>m.id!==t);this.representatives=x(v({},this.representatives),{[e]:l}),this.representativeCounts[e]=l.length},error:()=>{this.error="Error eliminando representante"}})}deleteOrganization(t){confirm("\xBFEliminar organizaci\xF3n?")&&this.organizationService.delete(t).subscribe({next:()=>this.fetchOrganizations(),error:()=>{this.error="Error eliminando organizaci\xF3n"}})}getActivityLabel(t){if(!t)return"\u2014";let e=k.find(i=>i.value===t);return e&&e.label?e.label:t}getRepresentativeCount(t){return this.representativeCounts[t]!==void 0?this.representativeCounts[t]:0}trackRep=(t,e)=>e.id?e.id:e.email;static \u0275fac=function(e){return new(e||n)(g(A),g(F),g(W),g(N))};static \u0275cmp=S({type:n,selectors:[["app-organization-list"]],decls:10,vars:4,consts:[[1,"section"],[1,"container"],[1,"title"],[1,"button","is-primary","mb-4",3,"click"],[4,"ngIf"],["class","notification is-danger",4,"ngIf"],["class","has-text-grey",4,"ngIf"],["class","box",4,"ngFor","ngForOf"],[1,"notification","is-danger"],[1,"has-text-grey"],[1,"box"],[1,"is-flex","is-justify-content-space-between","is-align-items-center","mb-2"],[1,"buttons"],["type","button",1,"button","is-success","is-small",3,"click"],[1,"tag","is-light","ml-2"],["type","button",1,"button","is-info","is-small",3,"click"],["type","button",1,"button","is-danger","is-small",3,"click"],[1,"mt-3"],[1,"is-flex","is-justify-content-space-between","is-align-items-center"],[1,"button","is-primary","is-small",3,"click"],[1,"mt-2"],["class","is-flex is-justify-content-space-between is-align-items-center",4,"ngFor","ngForOf","ngForTrackBy"],[1,"has-text-weight-semibold"],[1,"button","is-info","is-small",3,"click"],[1,"button","is-danger","is-small",3,"click"]],template:function(e,i){e&1&&(r(0,"section",0)(1,"div",1)(2,"h1",2),a(3,"Organizaciones"),o(),r(4,"button",3),u("click",function(){return i.goToNewOrganization()}),a(5,"+ Agregar organizaci\xF3n"),o(),p(6,re,2,0,"div",4)(7,ae,2,1,"div",5)(8,se,2,0,"div",6)(9,ve,19,6,"div",7),o()()),e&2&&(s(6),d("ngIf",i.loading),s(),d("ngIf",i.error),s(),d("ngIf",!i.loading&&i.organizations.length===0),s(),d("ngForOf",i.organizations))},dependencies:[y,I,R,T],encapsulation:2})};function fe(n,t){if(n&1&&(r(0,"div",21),a(1),o()),n&2){let e=c();s(),f(e.error)}}function _e(n,t){n&1&&(r(0,"p",22),a(1," Requerido "),o())}function he(n,t){if(n&1&&(r(0,"option",13),a(1),o()),n&2){let e=t.$implicit;d("ngValue",e.value),s(),f(e.label)}}function be(n,t){if(n&1&&(r(0,"option",13),a(1),o()),n&2){let e=t.$implicit;d("ngValue",e.id),s(),f(e.name)}}function xe(n,t){n&1&&(r(0,"p",22),a(1," Requerido "),o())}var z=class n{constructor(t,e,i,l,m){this.fb=t;this.organizationService=e;this.neighborhoodService=i;this.route=l;this.router=m}form;isEdit=!1;organizationId;error=null;neighborhoods=[];activities=k;ngOnInit(){this.form=this.fb.group({name:["",M.required],address:[""],mainActivity:[null],neighborhoodId:[null,M.required]});let t=this.route.snapshot.paramMap.get("id");t&&(this.isEdit=!0,this.organizationId=+t,this.loadOrganization()),this.loadNeighborhoods()}loadOrganization(){this.organizationService.getById(this.organizationId).subscribe({next:t=>{this.form.patchValue({name:t.name,address:t.address??"",mainActivity:t.mainActivity??null,neighborhoodId:t.neighborhoodId??null})},error:()=>this.error="Error al cargar la organizaci\xF3n"})}loadNeighborhoods(){this.neighborhoodService.getAll().subscribe({next:t=>this.neighborhoods=t,error:()=>this.error="Error cargando barrios"})}onSubmit(){if(this.form.invalid)return;let t=v({},this.form.value);(this.isEdit?this.organizationService.update(this.organizationId,t):this.organizationService.create(t)).subscribe({next:()=>this.router.navigate([_.Admin.Organizations.List]),error:i=>{i.status===409?this.error="Ya existe una organizaci\xF3n con ese nombre":i.status===404?this.error="Barrio no encontrado":this.error="Error guardando la organizaci\xF3n",console.error(i)}})}cancel(){this.router.navigate([_.Admin.Organizations.List])}static \u0275fac=function(e){return new(e||n)(g(K),g(A),g(F),g(B),g(N))};static \u0275cmp=S({type:n,selectors:[["app-organization-form"]],decls:40,vars:11,consts:[[1,"section"],[1,"container"],[1,"title"],["class","notification is-danger",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"field"],[1,"label"],[1,"control"],["type","text","formControlName","name",1,"input"],["class","help is-danger",4,"ngIf"],["type","text","formControlName","address",1,"input"],[1,"select","is-fullwidth"],["formControlName","mainActivity"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["formControlName","neighborhoodId"],["disabled","",3,"ngValue"],[1,"field","mt-4"],[1,"buttons"],["type","submit",1,"button","is-primary",3,"disabled"],["type","button",1,"button","is-danger",3,"click"],[1,"notification","is-danger"],[1,"help","is-danger"]],template:function(e,i){if(e&1&&(r(0,"section",0)(1,"div",1)(2,"h1",2),a(3),o(),p(4,fe,2,1,"div",3),r(5,"form",4),u("ngSubmit",function(){return i.onSubmit()}),r(6,"div",5)(7,"label",6),a(8,"Nombre"),o(),r(9,"div",7),w(10,"input",8),o(),p(11,_e,2,0,"p",9),o(),r(12,"div",5)(13,"label",6),a(14,"Direcci\xF3n"),o(),r(15,"div",7),w(16,"input",10),o()(),r(17,"div",5)(18,"label",6),a(19,"Actividad principal"),o(),r(20,"div",11)(21,"select",12)(22,"option",13),a(23,"- Seleccionar -"),o(),p(24,he,2,2,"option",14),o()()(),r(25,"div",5)(26,"label",6),a(27,"Barrio"),o(),r(28,"div",11)(29,"select",15)(30,"option",16),a(31,"Seleccionar barrio"),o(),p(32,be,2,2,"option",14),o()(),p(33,xe,2,0,"p",9),o(),r(34,"div",17)(35,"div",18)(36,"button",19),a(37),o(),r(38,"button",20),u("click",function(){return i.cancel()}),a(39,"Cancelar"),o()()()()()()),e&2){let l,m;s(3),f(i.isEdit?"Editar organizaci\xF3n":"Nueva organizaci\xF3n"),s(),d("ngIf",i.error),s(),d("formGroup",i.form),s(6),d("ngIf",((l=i.form.get("name"))==null?null:l.invalid)&&((l=i.form.get("name"))==null?null:l.touched)),s(11),d("ngValue",null),s(2),d("ngForOf",i.activities),s(6),d("ngValue",null),s(2),d("ngForOf",i.neighborhoods),s(),d("ngIf",((m=i.form.get("neighborhoodId"))==null?null:m.invalid)&&((m=i.form.get("neighborhoodId"))==null?null:m.touched)),s(3),d("disabled",i.form.invalid),s(),C(" ",i.isEdit?"Actualizar":"Crear"," ")}},dependencies:[y,I,R,Q,G,J,Y,j,H,D,q,P,U,T],encapsulation:2})};var Ue=[{path:"",component:V},{path:"new",component:z},{path:":id/edit",component:z}];export{Ue as organizationRoutes};
