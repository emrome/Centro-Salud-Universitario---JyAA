import{d as b,i as h}from"./chunk-OLTWCF2P.js";import{H as a,K as l,P as s,_b as c,bc as p,f,n as g}from"./chunk-ILAX3XGE.js";var n=class extends Error{};n.prototype.name="InvalidTokenError";function U(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,r)=>{let i=r.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i}))}function I(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return U(e)}catch{return atob(e)}}function v(t,e){if(typeof t!="string")throw new n("Invalid token specified: must be a string");e||(e={});let r=e.header===!0?0:1,i=t.split(".")[r];if(typeof i!="string")throw new n(`Invalid token specified: missing part #${r+1}`);let m;try{m=I(i)}catch(d){throw new n(`Invalid token specified: invalid base64 for part #${r+1} (${d.message})`)}try{return JSON.parse(m)}catch(d){throw new n(`Invalid token specified: invalid json for part #${r+1} (${d.message})`)}}var o=class{static getToken(){return localStorage.getItem("token")}static setToken(e){localStorage.setItem("token",e)}static clear(){localStorage.removeItem("token")}static getDecoded(){let e=this.getToken();if(!e)return null;try{return v(e)}catch{return null}}static getUserId(){return this.getDecoded()?.sub??null}static getRole(){return this.getDecoded()?.role??null}static isEnabled(){return this.getDecoded()?.enabled??!1}static isAuthenticated(){let e=this.getDecoded();return!!e&&e.exp*1e3>Date.now()}static getUserName(){let e=this.getDecoded();return e?`${e.firstName??""} ${e.lastName??""}`.trim():""}};var u=class t{constructor(e){this.http=e}base=`${p.apiUrl}/me`;getMe(){return this.http.get(this.base)}updateMe(e){return this.http.put(this.base,e)}changePassword(e){return this.http.put(`${this.base}/password`,e)}static \u0275fac=function(r){return new(r||t)(s(c))};static \u0275prov=l({token:t,factory:t.\u0275fac,providedIn:"root"})};var w=class t{constructor(e,r,i){this.http=e;this.router=r;this.profile=i}currentUserSubject=new f(null);currentUser$=this.currentUserSubject.asObservable();login(e){return this.http.post(`${p.apiUrl}/login`,e).pipe(a(r=>o.setToken(r.token)),a(()=>this.loadCurrentUser().subscribe()))}loadCurrentUser(){return this.profile.getMe().pipe(g(e=>e.data),a(e=>this.currentUserSubject.next(e)))}refreshCurrentUser(){this.loadCurrentUser().subscribe()}logout(){o.clear(),this.currentUserSubject.next(null),this.router.navigate([h.Public.Root])}isAuthenticated(){return o.isAuthenticated()}getUserRole(){return o.getRole()}getUserId(){return o.getUserId()}isEnabled(){return o.isEnabled()}static \u0275fac=function(r){return new(r||t)(s(c),s(b),s(u))};static \u0275prov=l({token:t,factory:t.\u0275fac,providedIn:"root"})};export{o as a,u as b,w as c};
