import{a as k}from"./chunk-6MTLELMI.js";import{a as $}from"./chunk-MOKCNWZY.js";import{a as L}from"./chunk-VWLE3RA7.js";import{b as A,c as m,d as D,e as R,g as M,i as V,j as G,k as q,l as B,m as P,p as U,r as j}from"./chunk-4ZEEV3KU.js";import{a as W}from"./chunk-MC4TDR63.js";import{b as F,d as O,h as x,i as T}from"./chunk-OLTWCF2P.js";import{$a as c,Ea as I,Ja as d,Nb as _,Ob as h,Pb as N,Qa as a,Sb as C,Ua as l,Va as o,Wa as f,_a as g,hb as s,ib as u,jb as E,qb as v,ua as i,ya as p}from"./chunk-ILAX3XGE.js";import{a as b}from"./chunk-FDERIQAA.js";var Y=[{value:"WOMAN_CIS",label:"Mujer cis"},{value:"WOMAN_TRANS",label:"Mujer trans / travesti"},{value:"MAN_CIS",label:"Var\xF3n cis"},{value:"MAN_TRANS",label:"Var\xF3n trans / masculinidad trans"},{value:"NON_BINARY",label:"No binarie"},{value:"OTHER_IDENTITY",label:"Otra identidad / ninguna de las anteriores"},{value:"DONT_KNOW_OR_NO_ANSWER",label:"No sabe o no contesta"}];var w=[{value:"STUDENT",label:"Estudiante"},{value:"PROFESSIONAL",label:"Profesional"},{value:"CSU_STAFF",label:"Personal CSU"},{value:"VOLUNTEER",label:"Voluntario"},{value:"OTHER",label:"Otro"}];var S=r=>({"is-danger":r});function z(r,n){if(r&1&&(l(0,"div",20),s(1),o()),r&2){let e=c();i(),u(e.error)}}function K(r,n){if(r&1&&(l(0,"p",21),s(1),o()),r&2){let e=c();i(),u(e.getError("dni"))}}function J(r,n){if(r&1&&(l(0,"option",22),s(1),o()),r&2){let e=n.$implicit;a("value",e.value),i(),u(e.label)}}function Q(r,n){if(r&1&&(l(0,"p",21),s(1),o()),r&2){let e=c();i(),u(e.getError("gender"))}}function X(r,n){if(r&1&&(l(0,"option",22),s(1),o()),r&2){let e=n.$implicit;a("value",e.value),i(),u(e.label)}}function Z(r,n){if(r&1&&(l(0,"p",21),s(1),o()),r&2){let e=c();i(),u(e.getError("occupation"))}}var H=class r{constructor(n,e,t,y){this.fb=n;this.route=e;this.router=t;this.surveyorService=y}form;isEdit=!1;surveyorId;error=null;paths=T;submitted=!1;genders=Y;occupations=w;ngOnInit(){this.form=this.fb.group({firstName:["",[m.required,m.minLength(2)]],lastName:["",[m.required,m.minLength(2)]],birthDate:["",[m.required,L.minAge(16)]],dni:["",[m.required,m.pattern(/^\d{7,9}$/)]],gender:[null,[m.required]],occupation:[null,[m.required]]});let n=this.route.snapshot.paramMap.get("id");n&&(this.isEdit=!0,this.surveyorId=+n,this.loadSurveyor())}loadSurveyor(){this.surveyorService.getById(this.surveyorId).subscribe({next:n=>this.form.patchValue(n),error:()=>this.error="Error al cargar el encuestador"})}onSubmit(){if(this.submitted=!0,this.form.invalid){this.form.markAllAsTouched();return}let n=b({},this.form.value);(this.isEdit?this.surveyorService.update(this.surveyorId,n):this.surveyorService.create(n)).subscribe({next:()=>this.router.navigate([this.paths.Admin.Surveyors.List]),error:t=>{t.status===409?this.error="El DNI ya est\xE1 en uso":t.status===400?this.error="Datos inv\xE1lidos":this.error="Error al guardar"}})}cancel(){this.router.navigate([this.paths.Admin.Surveyors.List])}fieldInvalid(n){let e=this.form.get(n);return!!e&&e.invalid&&(e.touched||e.dirty||this.submitted)}getError(n){let e=this.form.get(n);return!e||!e.errors?"":e.errors.pattern?"Formato de dni inv\xE1lido, debe tener entre 7 y 9 d\xEDgitos":"Dato inv\xE1lido"}maxBirthDate(){return $.isoDateTodayMinusYears(16)}static \u0275fac=function(e){return new(e||r)(p(U),p(F),p(O),p(W))};static \u0275cmp=I({type:r,selectors:[["app-surveyor-form"]],decls:39,vars:24,consts:[[1,"section"],[1,"container"],[1,"title"],["class","notification is-danger",4,"ngIf"],["novalidate","",3,"ngSubmit","formGroup"],[3,"form","submitted","maxDate"],[1,"field"],[1,"label"],[1,"control"],["type","text","formControlName","dni",1,"input",3,"ngClass"],["class","help is-danger",4,"ngIf"],[1,"select","is-fullwidth",3,"ngClass"],["formControlName","gender"],["disabled","",3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],["formControlName","occupation"],[1,"field","mt-4"],[1,"buttons"],["type","submit",1,"button","is-primary",3,"disabled"],["type","button",1,"button","is-danger",3,"click"],[1,"notification","is-danger"],[1,"help","is-danger"],[3,"value"]],template:function(e,t){e&1&&(l(0,"section",0)(1,"div",1)(2,"h1",2),s(3),o(),d(4,z,2,1,"div",3),l(5,"form",4),g("ngSubmit",function(){return t.onSubmit()}),f(6,"app-person-form-base",5),l(7,"div",6)(8,"label",7),s(9,"DNI"),o(),l(10,"div",8),f(11,"input",9),o(),d(12,K,2,1,"p",10),o(),l(13,"div",6)(14,"label",7),s(15,"G\xE9nero"),o(),l(16,"div",8)(17,"div",11)(18,"select",12)(19,"option",13),s(20,"Seleccionar..."),o(),d(21,J,2,2,"option",14),o()()(),d(22,Q,2,1,"p",10),o(),l(23,"div",6)(24,"label",7),s(25,"Ocupaci\xF3n"),o(),l(26,"div",8)(27,"div",11)(28,"select",15)(29,"option",13),s(30,"Seleccionar..."),o(),d(31,X,2,2,"option",14),o()()(),d(32,Z,2,1,"p",10),o(),l(33,"div",16)(34,"div",17)(35,"button",18),s(36),o(),l(37,"button",19),g("click",function(){return t.cancel()}),s(38,"Cancelar"),o()()()()()()),e&2&&(i(3),u(t.isEdit?"Editar encuestador":"Nuevo encuestador"),i(),a("ngIf",t.error),i(),a("formGroup",t.form),i(),a("form",t.form)("submitted",t.submitted)("maxDate",t.maxBirthDate()),i(5),a("ngClass",v(18,S,t.fieldInvalid("dni"))),i(),a("ngIf",t.fieldInvalid("dni")),i(5),a("ngClass",v(20,S,t.fieldInvalid("gender"))),i(2),a("ngValue",null),i(2),a("ngForOf",t.genders),i(),a("ngIf",t.fieldInvalid("gender")),i(5),a("ngClass",v(22,S,t.fieldInvalid("occupation"))),i(2),a("ngValue",null),i(2),a("ngForOf",t.occupations),i(),a("ngIf",t.fieldInvalid("occupation")),i(3),a("disabled",t.form.invalid),i(),E(" ",t.isEdit?"Actualizar":"Crear"," "))},dependencies:[C,_,h,N,j,M,B,P,A,q,D,R,V,G,x,k],encapsulation:2})};export{H as SurveyorFormComponent};
