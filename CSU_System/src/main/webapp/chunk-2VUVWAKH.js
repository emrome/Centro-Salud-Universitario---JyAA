import{a as re}from"./chunk-N333UUWU.js";import{a as te}from"./chunk-MOKCNWZY.js";import{a as ie}from"./chunk-VVQ6IMPO.js";import{a as S}from"./chunk-VWLE3RA7.js";import{b as G,c as d,d as B,e as U,g as Y,i as J,j as K,k as Q,l as W,m as X,p as Z,r as ee}from"./chunk-4ZEEV3KU.js";import{d as $,i as L}from"./chunk-OLTWCF2P.js";import{$a as f,Ea as z,Ja as p,K as I,Nb as P,Ob as k,P as R,Pa as y,Pb as M,Qa as m,Sa as u,Sb as j,Ua as l,Va as n,W as T,Wa as g,X as O,Y as b,Za as V,_a as _,_b as q,bc as H,gb as F,hb as s,ib as c,jb as N,qb as D,ua as a,vb as A,ya as v}from"./chunk-ILAX3XGE.js";import"./chunk-FDERIQAA.js";var h=class r{constructor(i){this.http=i}baseUrl=H.apiUrl;register(i){return this.http.post(`${this.baseUrl}/register`,i)}static \u0275fac=function(e){return new(e||r)(R(q))};static \u0275prov=I({token:r,factory:r.\u0275fac,providedIn:"root"})};var le=r=>({"is-active":r});function se(r,i){if(r&1){let e=V();l(0,"div",36)(1,"button",37),_("click",function(){T(e);let o=f();return O(o.error=null)}),n(),s(2),n()}if(r&2){let e=f();a(2),N(" ",e.error," ")}}function me(r,i){if(r&1&&(l(0,"p",38),s(1),n()),r&2){let e=i.$implicit;a(),c(e)}}function pe(r,i){if(r&1&&(l(0,"p",38),s(1),n()),r&2){let e=i.$implicit;a(),c(e)}}function de(r,i){if(r&1&&(l(0,"p",38),s(1),n()),r&2){let e=i.$implicit;a(),c(e)}}function ce(r,i){if(r&1&&(l(0,"p",38),s(1),n()),r&2){let e=i.$implicit;a(),c(e)}}function ue(r,i){if(r&1&&(l(0,"p",38),s(1),n()),r&2){let e=i.$implicit;a(),c(e)}}function ge(r,i){r&1&&(b(),l(0,"svg",39),g(1,"path",40),n())}function fe(r,i){r&1&&(b(),l(0,"svg",39),g(1,"path",41),n())}function ve(r,i){if(r&1&&(l(0,"p",38),s(1),n()),r&2){let e=i.$implicit;a(),c(e)}}function _e(r,i){if(r&1&&(l(0,"option",45),s(1),n()),r&2){let e=i.$implicit;m("value",e.value),a(),c(e.label)}}function he(r,i){if(r&1&&(l(0,"p",38),s(1),n()),r&2){let e=i.$implicit;a(),c(e)}}function be(r,i){if(r&1&&(l(0,"p",38),s(1),n()),r&2){let e=i.$implicit;a(),c(e)}}function ye(r,i){if(r&1&&(l(0,"div")(1,"div",7)(2,"label",8),s(3,"Especialidad"),n(),l(4,"div",9)(5,"div",10)(6,"select",42)(7,"option",12),s(8,"Seleccion\xE1 una especialidad"),n(),p(9,_e,2,2,"option",43),n()()(),p(10,he,2,1,"p",15),n(),l(11,"div",7)(12,"label",8),s(13,"Matr\xEDcula"),n(),g(14,"input",44),p(15,be,2,1,"p",15),n()()),r&2){let e,t,o=f();a(6),u("is-danger",o.submitted&&((e=o.form.get("specialty"))==null?null:e.invalid)),a(),m("ngValue",null),a(2),m("ngForOf",o.specialties),a(),m("ngForOf",o.getErrors("specialty")),a(4),u("is-danger",o.submitted&&((t=o.form.get("license"))==null?null:t.invalid)),a(),m("ngForOf",o.getErrors("license"))}}function Se(r,i){if(r&1&&(l(0,"option",50),s(1),n()),r&2){let e=i.$implicit;m("ngValue",e.id),a(),c(e.name)}}function Ee(r,i){if(r&1&&(l(0,"div",9)(1,"div",10)(2,"select",48)(3,"option",12),s(4,"Seleccionar organizaci\xF3n"),n(),p(5,Se,2,2,"option",49),n()()()),r&2){let e,t=f(2);a(2),u("is-danger",(t.submitted||((e=t.form.get("organizationId"))==null?null:e.touched))&&((e=t.form.get("organizationId"))==null?null:e.invalid)),a(),m("ngValue",null),a(2),m("ngForOf",t.organizations)}}function Ce(r,i){r&1&&(l(0,"p",51),s(1,"Cargando organizaciones..."),n())}function xe(r,i){r&1&&(l(0,"p",38),s(1," Seleccion\xE1 una organizaci\xF3n "),n())}function we(r,i){if(r&1&&(l(0,"div",7)(1,"label",8),s(2,"Organizaci\xF3n"),n(),p(3,Ee,6,4,"div",46)(4,Ce,2,0,"ng-template",null,0,A)(6,xe,2,0,"p",47),n()),r&2){let e,t=F(5),o=f();a(3),m("ngIf",!o.loadingOrganizations)("ngIfElse",t),a(3),m("ngIf",(o.submitted||((e=o.form.get("organizationId"))==null?null:e.touched))&&((e=o.form.get("organizationId"))==null?null:e.invalid))}}var ne=class r{constructor(i,e,t,o){this.fb=i;this.registerService=e;this.organizationService=t;this.router=o;this.form=this.fb.group({userType:["HealthStaff",d.required],firstName:["",[d.required,d.minLength(2)]],lastName:["",[d.required,d.minLength(2)]],birthDate:["",[d.required,S.minAge(18)]],email:["",[d.required,d.email]],password:["",[d.required,d.minLength(8),S.strongPassword()]],specialty:[""],license:[""],organizationId:[null]})}form;userType="HealthStaff";submitted=!1;isSubmitting=!1;error=null;success=!1;specialties=ie;organizations=[];loadingOrganizations=!1;ngOnInit(){this.applyDynamicValidators(),this.form.get("userType")?.valueChanges.subscribe(i=>{this.userType=i,this.applyDynamicValidators(),this.resetTypeSpecificFields(i)}),this.loadOrganizations()}passwordVisible=!1;togglePassword(){this.passwordVisible=!this.passwordVisible}loadOrganizations(){this.loadingOrganizations=!0,this.organizationService.getAll().subscribe({next:i=>{this.organizations=i.slice().sort((e,t)=>e.name.localeCompare(t.name)),this.loadingOrganizations=!1},error:()=>{this.loadingOrganizations=!1,this.error="Error cargando organizaciones"}}),this.applyDynamicValidators()}applyDynamicValidators(){let i=this.form.get("userType")?.value,e=this.form.get("specialty"),t=this.form.get("license"),o=this.form.get("organizationId");e.clearValidators(),t.clearValidators(),o.clearValidators(),i==="HealthStaff"?(e.setValidators([d.required]),t.setValidators([d.required])):i==="SocialOrgRepresentative"&&o.setValidators([d.required]),e.updateValueAndValidity({emitEvent:!1}),t.updateValueAndValidity({emitEvent:!1}),o.updateValueAndValidity({emitEvent:!1})}resetTypeSpecificFields(i){i!=="HealthStaff"&&(this.form.get("specialty")?.reset(""),this.form.get("license")?.reset("")),i!=="SocialOrgRepresentative"&&this.form.get("organizationId")?.reset(null)}onSubmit(){if(this.submitted=!0,this.error=null,this.success=!1,this.form.invalid)return;this.isSubmitting=!0;let i=this.form.value,e={userType:i.userType,firstName:i.firstName,lastName:i.lastName,birthDate:i.birthDate,email:i.email,password:i.password,enabled:!1};i.userType==="HealthStaff"?(e.specialty=i.specialty,e.license=i.license):i.userType==="SocialOrgRepresentative"&&(e.organizationId=Number(i.organizationId)),this.registerService.register(e).subscribe({next:()=>{this.isSubmitting=!1,this.success=!0,this.error=null},error:t=>{if(this.isSubmitting=!1,t?.status===400&&Array.isArray(t.error?.details)&&t.error.details.length){this.error=t.error.details.map(o=>o.message).join(" \xB7 ");return}if(t?.status===409){let o=(typeof t.error=="string"?t.error:t.error?.message||"").toLowerCase();o.includes("email")?this.error="Ya existe una cuenta con este correo electr\xF3nico.":o.includes("license")?this.error="Ya existe una cuenta con esta matr\xEDcula/licencia.":this.error="No se pudo completar el registro. Verific\xE1 los datos ingresados.";return}if(t?.status===400&&/edad|under|18/.test((t.error?.message||"").toLowerCase())){this.error="Deb\xE9s ser mayor de 18 a\xF1os para registrarte.";return}this.error="Error inesperado. Intent\xE1 nuevamente m\xE1s tarde."}})}get maxBirthDate(){return te.isoDateTodayMinusYears(18)}getErrors(i){let e=this.form.get(i);if(!e||!e.errors)return[];if(!(this.submitted||e.dirty||e.touched))return[];let o=[];return e.errors.required&&o.push("Requerido"),e.errors.email&&o.push("Formato inv\xE1lido"),e.errors.minlength&&o.push(`M\xEDnimo ${e.errors.minlength.requiredLength} caracteres`),e.errors.weakPassword&&o.push("Debe contener may\xFAscula, min\xFAscula, n\xFAmero y s\xEDmbolo"),e.errors.underAge&&o.push("Deb\xE9s ser mayor de 18 a\xF1os"),o}closeModal(){this.success=!1,this.router.navigate([L.Public.Root])}static \u0275fac=function(e){return new(e||r)(v(Z),v(h),v(re),v($))};static \u0275cmp=z({type:r,selectors:[["app-register"]],decls:66,vars:32,consts:[["loadingOrgsTpl",""],[1,"section"],[1,"container"],[1,"box",2,"max-width","600px","margin","auto"],[1,"title","has-text-centered"],["class","notification is-danger is-light",4,"ngIf"],["novalidate","",3,"ngSubmit","formGroup"],[1,"field"],[1,"label"],[1,"control"],[1,"select","is-fullwidth"],["formControlName","userType"],["disabled","",3,"ngValue"],["value","HealthStaff"],["value","SocialOrgRepresentative"],["class","help is-danger",4,"ngFor","ngForOf"],["placeholder","Ej: Ana","formControlName","firstName","autocomplete","given-name",1,"input"],["placeholder","Ej: Romero","formControlName","lastName","autocomplete","family-name",1,"input"],["type","date","formControlName","birthDate",1,"input"],["type","email","placeholder","Ej: ana@mail.com","formControlName","email","autocomplete","email","autocapitalize","off",1,"input"],[1,"control","has-icons-right"],["placeholder","Ej: Seguridad2024!","formControlName","password","autocomplete","new-password",1,"input",3,"type"],["role","button","tabindex","0",1,"icon","is-small","is-right",2,"cursor","pointer","pointer-events","auto",3,"click","keydown.enter","keydown.space"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","width","20","height","20","aria-hidden","true",4,"ngIf"],[4,"ngIf"],["class","field",4,"ngIf"],[1,"field","mt-4"],["type","submit",1,"button","is-primary","is-fullwidth",3,"disabled"],[1,"modal",3,"ngClass"],[1,"modal-background"],[1,"modal-card"],[1,"modal-card-head"],[1,"modal-card-title"],[1,"modal-card-body"],[1,"modal-card-foot"],[1,"button","is-success",3,"click"],[1,"notification","is-danger","is-light"],[1,"delete",3,"click"],[1,"help","is-danger"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","width","20","height","20","aria-hidden","true"],["fill","currentColor","d","M12 5c5 0 9.27 3.11 11 7-1.73 3.89-6 7-11 7S2.73 15.89 1 12C2.73 8.11 7 5 12 5zm0 2C8.14 7 4.79 9.29 3.35 12 4.79 14.71 8.14 17 12 17s7.21-2.29 8.65-5C19.21 9.29 15.86 7 12 7zm0 2a3 3 0 110 6 3 3 0 010-6z"],["fill","currentColor","d","M2 5.27L3.28 4l16.97 16.97-1.27 1.27-2.56-2.56A12.1 12.1 0 0112 19c-5 0-9.27-3.11-11-7a12.9 12.9 0 013.74-4.67L2 5.27zM7.11 7.38A10.2 10.2 0 004.35 12c1.44 2.71 4.79 5 7.65 5 1.36 0 2.64-.3 3.79-.85l-1.67-1.67c-.33.13-.68.2-1.05.2a3 3 0 01-3-3c0-.37.07-.72.2-1.05L7.11 7.38zM12 7c.9 0 1.76.16 2.55.46l-1.54 1.54A2.98 2.98 0 0012 9a3 3 0 00-3 3c0 .46.11.89.3 1.27l-1.5-1.5A10.2 10.2 0 0112 7zm7.65 5c-.49.91-1.13 1.75-1.9 2.5l-1.42-1.42A5 5 0 0017 12a5 5 0 00-5-5c-.38 0-.75.04-1.1.12L9.24 5.45A12.3 12.3 0 0112 5c5 0 9.27 3.11 11 7-.4.9-.92 1.74-1.52 2.5l-1.83-1.83z"],["formControlName","specialty"],[3,"value",4,"ngFor","ngForOf"],["placeholder","Ej: MP123456","formControlName","license",1,"input"],[3,"value"],["class","control",4,"ngIf","ngIfElse"],["class","help is-danger",4,"ngIf"],["formControlName","organizationId"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"],[1,"has-text-grey"]],template:function(e,t){if(e&1&&(l(0,"section",1)(1,"div",2)(2,"div",3)(3,"h1",4),s(4,"Registro de usuario"),n(),p(5,se,3,1,"div",5),l(6,"form",6),_("ngSubmit",function(){return t.onSubmit()}),l(7,"div",7)(8,"label",8),s(9,"Tipo de usuario"),n(),l(10,"div",9)(11,"div",10)(12,"select",11)(13,"option",12),s(14,"Seleccion\xE1 un tipo"),n(),l(15,"option",13),s(16,"Personal de Salud"),n(),l(17,"option",14),s(18,"Referente de Organizaci\xF3n Social"),n()()()(),p(19,me,2,1,"p",15),n(),l(20,"div",7)(21,"label",8),s(22,"Nombre"),n(),g(23,"input",16),p(24,pe,2,1,"p",15),n(),l(25,"div",7)(26,"label",8),s(27,"Apellido"),n(),g(28,"input",17),p(29,de,2,1,"p",15),n(),l(30,"div",7)(31,"label",8),s(32,"Fecha de nacimiento"),n(),g(33,"input",18),p(34,ce,2,1,"p",15),n(),l(35,"div",7)(36,"label",8),s(37,"Email"),n(),g(38,"input",19),p(39,ue,2,1,"p",15),n(),l(40,"div",7)(41,"label",8),s(42,"Contrase\xF1a"),n(),l(43,"div",20),g(44,"input",21),l(45,"span",22),_("click",function(){return t.togglePassword()})("keydown.enter",function(){return t.togglePassword()})("keydown.space",function(){return t.togglePassword()}),p(46,ge,2,0,"svg",23)(47,fe,2,0,"svg",23),n()(),p(48,ve,2,1,"p",15),n(),p(49,ye,16,8,"div",24)(50,we,7,3,"div",25),l(51,"div",26)(52,"button",27),s(53," Registrarse "),n()()()()()(),l(54,"div",28),g(55,"div",29),l(56,"div",30)(57,"header",31)(58,"p",32),s(59,"Registro exitoso"),n()(),l(60,"section",33)(61,"p"),s(62,"Tu usuario fue registrado correctamente. Deber\xE1s esperar a ser habilitado por un administrador."),n()(),l(63,"footer",34)(64,"button",35),_("click",function(){return t.closeModal()}),s(65,"Aceptar"),n()()()()),e&2){let o,E,C,x,w;a(5),m("ngIf",t.error),a(),m("formGroup",t.form),a(7),m("ngValue",null),a(6),m("ngForOf",t.getErrors("userType")),a(4),u("is-danger",t.submitted&&((o=t.form.get("firstName"))==null?null:o.invalid)),a(),m("ngForOf",t.getErrors("firstName")),a(4),u("is-danger",t.submitted&&((E=t.form.get("lastName"))==null?null:E.invalid)),a(),m("ngForOf",t.getErrors("lastName")),a(4),u("is-danger",t.submitted&&((C=t.form.get("birthDate"))==null?null:C.invalid)),y("max",t.maxBirthDate),a(),m("ngForOf",t.getErrors("birthDate")),a(4),u("is-danger",t.submitted&&((x=t.form.get("email"))==null?null:x.invalid)),a(),m("ngForOf",t.getErrors("email")),a(5),u("is-danger",t.submitted&&((w=t.form.get("password"))==null?null:w.invalid)),m("type",t.passwordVisible?"text":"password"),a(),y("aria-label",t.passwordVisible?"Ocultar contrase\xF1a":"Mostrar contrase\xF1a"),a(),m("ngIf",!t.passwordVisible),a(),m("ngIf",t.passwordVisible),a(),m("ngForOf",t.getErrors("password")),a(),m("ngIf",t.userType==="HealthStaff"),a(),m("ngIf",t.userType==="SocialOrgRepresentative"),a(2),u("is-loading",t.isSubmitting),m("disabled",t.form.invalid||t.isSubmitting),a(2),m("ngClass",D(30,le,t.success))}},dependencies:[j,P,k,M,ee,Y,W,X,G,Q,B,U,J,K],encapsulation:2})};export{ne as RegisterComponent};
