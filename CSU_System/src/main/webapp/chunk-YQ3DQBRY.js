import{a as Ce}from"./chunk-6MTLELMI.js";import{a as re,b as ne}from"./chunk-NDEZVH2L.js";import{a as oe}from"./chunk-FSAZUVLP.js";import{a as _e}from"./chunk-N333UUWU.js";import{a as pe}from"./chunk-MOKCNWZY.js";import{a as Se}from"./chunk-VVQ6IMPO.js";import{c as he}from"./chunk-AUN2S5OM.js";import{a as O}from"./chunk-VWLE3RA7.js";import{a as be,b as q,c as u,d as D,e as T,g as G,i as L,j as k,k as ee,l as te,m as ie,p as P,r as z}from"./chunk-4ZEEV3KU.js";import{b as B,d as y,h as F,i as _}from"./chunk-OLTWCF2P.js";import{$a as d,Ea as I,Ja as c,Nb as V,Ob as A,Pa as R,Pb as x,Qa as l,Sb as E,Ta as ue,Ua as a,Va as n,W as h,Wa as S,X as b,Y as de,Za as N,_a as f,gb as ge,hb as s,ib as v,jb as g,kb as H,qb as w,ua as o,vb as ve,ya as p}from"./chunk-ILAX3XGE.js";import{a as U,b as Z}from"./chunk-FDERIQAA.js";var ae=class{id;firstName;lastName;birthDate;email;password;registrationDate;enabled;positionInCSU;deleted};function Ee(r,t){r&1&&(a(0,"div"),s(1,"Cargando..."),n())}function ye(r,t){if(r&1&&(a(0,"div",8),s(1),n()),r&2){let e=d();o(),v(e.error)}}function Fe(r,t){if(r&1){let e=N();a(0,"div",9)(1,"div",10)(2,"strong"),s(3),n(),a(4,"div",11)(5,"button",12),f("click",function(){let m=h(e).$implicit,C=d();return b(C.goToEdit(m.id))}),s(6,"Editar"),n(),a(7,"button",13),f("click",function(){let m=h(e).$implicit,C=d();return b(C.deleteAdmin(m.id))}),s(8,"Borrar"),n()()(),a(9,"p",14),s(10),n(),a(11,"p",14),s(12),n()()}if(r&2){let e=t.$implicit;o(3),H("",e.firstName," ",e.lastName,""),o(7),g("Email: ",e.email,""),o(2),g("Cargo: ",e.positionInCSU,"")}}function we(r,t){r&1&&(a(0,"p",14),s(1," No se encontraron administradores. "),n())}var se=class r{constructor(t,e,i){this.adminService=t;this.router=e;this.auth=i}admins=[];loading=!0;error=null;paths=_;currentUserIdNum;ngOnInit(){let t=this.auth.getUserId(),e=t!==null?Number(t):void 0;this.currentUserIdNum=Number.isFinite(e)?e:void 0,this.fetchAdmins()}fetchAdmins(){this.loading=!0,this.adminService.getAll().subscribe({next:t=>{ae,this.admins=t.filter(e=>e.enabled).filter(e=>this.currentUserIdNum===void 0?!0:e.id!==this.currentUserIdNum),this.loading=!1},error:t=>{this.error="Error cargando administradores",this.loading=!1,console.error(t)}})}goToNew(){this.router.navigate([this.paths.Admin.Admins.New])}goToEdit(t){this.router.navigate([this.paths.Admin.Admins.Edit(t)])}deleteAdmin(t){confirm("\xBFSeguro que quer\xE9s eliminar este administrador?")&&this.adminService.delete(t).subscribe({next:()=>this.fetchAdmins(),error:e=>{this.error="Error eliminando el administrador",console.error(e)}})}static \u0275fac=function(e){return new(e||r)(p(re),p(y),p(he))};static \u0275cmp=I({type:r,selectors:[["app-admin-list"]],decls:10,vars:4,consts:[[1,"section"],[1,"container"],[1,"title"],[1,"button","is-primary","mb-4",3,"click"],[4,"ngIf"],["class","notification is-danger",4,"ngIf"],["class","box",4,"ngFor","ngForOf"],["class","has-text-grey",4,"ngIf"],[1,"notification","is-danger"],[1,"box"],[1,"is-flex","is-justify-content-space-between","is-align-items-center","mb-2"],[1,"buttons"],[1,"button","is-info","is-small",3,"click"],[1,"button","is-danger","is-small",3,"click"],[1,"has-text-grey"]],template:function(e,i){e&1&&(a(0,"section",0)(1,"div",1)(2,"h1",2),s(3,"Administradores"),n(),a(4,"button",3),f("click",function(){return i.goToNew()}),s(5,"+ Nuevo administrador"),n(),c(6,Ee,2,0,"div",4)(7,ye,2,1,"div",5)(8,Fe,13,4,"div",6)(9,we,2,0,"p",7),n()()),e&2&&(o(6),l("ngIf",i.loading),o(),l("ngIf",i.error),o(),l("ngForOf",i.admins),o(),l("ngIf",!i.loading&&i.admins.length===0))},dependencies:[E,A,x,F],encapsulation:2})};var ce=r=>({"is-danger":r});function Ne(r,t){if(r&1&&(a(0,"p",12),s(1),n()),r&2){let e=d();o(),g(" ",e.getError("email")," ")}}function Ae(r,t){r&1&&(de(),a(0,"svg",19),S(1,"path",20),n())}function Re(r,t){r&1&&(de(),a(0,"svg",19),S(1,"path",21),n())}function Oe(r,t){if(r&1&&(a(0,"p",22),s(1),n()),r&2){let e=d(2);o(),g(" ",e.getError("password")," ")}}function Ve(r,t){if(r&1){let e=N();a(0,"div",2)(1,"label",13),s(2,"Contrase\xF1a"),n(),a(3,"div",14),S(4,"input",15),a(5,"span",16),f("click",function(){h(e);let m=d();return b(m.togglePassword())})("keydown.enter",function(){h(e);let m=d();return b(m.togglePassword())})("keydown.space",function(){h(e);let m=d();return b(m.togglePassword())}),c(6,Ae,2,0,"svg",17)(7,Re,2,0,"svg",17),n()(),c(8,Oe,2,1,"p",18),n()}if(r&2){let e=d();o(4),l("type",e.passwordVisible?"text":"password")("ngClass",w(9,ce,e.fieldInvalid("password"))),R("aria-invalid",e.fieldInvalid("password"))("aria-describedby",e.fieldInvalid("password")?"password-error":null)("aria-label",e.passwordVisible?"Ocultar contrase\xF1a":"Mostrar contrase\xF1a"),o(),R("aria-pressed",e.passwordVisible),o(),l("ngIf",!e.passwordVisible),o(),l("ngIf",e.passwordVisible),o(),l("ngIf",e.fieldInvalid("password"))}}function De(r,t){if(r&1&&(a(0,"p",23),s(1),n()),r&2){let e=d();o(),g(" ",e.getError("registrationDate")," ")}}var M=class r{form;submitted=!1;isEdit=!1;maxBirthDate(){return pe.isoDateTodayMinusYears(18)}get maxRegistrationDate(){return pe.isoDateToday()}fieldInvalid(t){let e=this.form?.get(t);return!!e&&e.invalid&&(e.touched||e.dirty||this.submitted)}passwordVisible=!1;togglePassword(){this.passwordVisible=!this.passwordVisible}getError(t){let e=this.form?.get(t);if(!e||!e.errors)return"";let i=e.errors;return i.required?"Este campo es obligatorio":i.email?"Email inv\xE1lido":i.minlength?`M\xEDnimo ${i.minlength.requiredLength} caracteres`:i.weakPassword?"Debe incluir may\xFAscula, min\xFAscula y n\xFAmero":i.futureDate?"La fecha no puede ser en el futuro":"Dato inv\xE1lido"}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=I({type:r,selectors:[["app-user-form-base"]],inputs:{form:"form",submitted:"submitted",isEdit:"isEdit"},decls:19,vars:18,consts:[[3,"form","submitted","maxDate"],[3,"formGroup"],[1,"field"],["for","email",1,"label"],[1,"control"],["id","email","type","email","formControlName","email","autocomplete","email",1,"input",3,"ngClass"],["id","email-error","class","help is-danger",4,"ngIf"],["for","registrationDate",1,"label"],["id","registrationDate","type","date","formControlName","registrationDate",1,"input",3,"ngClass"],["id","registrationDate-error","class","help is-danger",4,"ngIf"],[1,"checkbox"],["type","checkbox","formControlName","enabled"],["id","email-error",1,"help","is-danger"],["for","password",1,"label"],[1,"control","has-icons-right"],["id","password","formControlName","password","autocomplete","new-password",1,"input",3,"type","ngClass"],["role","button","tabindex","0",1,"icon","is-small","is-right",2,"cursor","pointer","pointer-events","auto",3,"click","keydown.enter","keydown.space"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","width","20","height","20","aria-hidden","true",4,"ngIf"],["id","password-error","class","help is-danger",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","width","20","height","20","aria-hidden","true"],["fill","currentColor","d","M12 5c5 0 9.27 3.11 11 7-1.73 3.89-6 7-11 7S2.73 15.89 1 12C2.73 8.11 7 5 12 5zm0 2C8.14 7 4.79 9.29 3.35 12 4.79 14.71 8.14 17 12 17s7.21-2.29 8.65-5C19.21 9.29 15.86 7 12 7zm0 2a3 3 0 110 6 3 3 0 010-6z"],["fill","currentColor","d","M2 5.27L3.28 4l16.97 16.97-1.27 1.27-2.56-2.56A12.1 12.1 0 0112 19c-5 0-9.27-3.11-11-7a12.9 12.9 0 013.74-4.67L2 5.27zM7.11 7.38A10.2 10.2 0 004.35 12c1.44 2.71 4.79 5 7.65 5 1.36 0 2.64-.3 3.79-.85l-1.67-1.67c-.33.13-.68.2-1.05.2a3 3 0 01-3-3c0-.37.07-.72.2-1.05L7.11 7.38zM12 7c.9 0 1.76.16 2.55.46l-1.54 1.54A2.98 2.98 0 0012 9a3 3 0 00-3 3c0 .46.11.89.3 1.27l-1.5-1.5A10.2 10.2 0 0112 7zm7.65 5c-.49.91-1.13 1.75-1.9 2.5l-1.42-1.42A5 5 0 0017 12a5 5 0 00-5-5c-.38 0-.75.04-1.1.12L9.24 5.45A12.3 12.3 0 0112 5c5 0 9.27 3.11 11 7-.4.9-.92 1.74-1.52 2.5l-1.83-1.83z"],["id","password-error",1,"help","is-danger"],["id","registrationDate-error",1,"help","is-danger"]],template:function(e,i){e&1&&(S(0,"app-person-form-base",0),a(1,"div",1)(2,"div",2)(3,"label",3),s(4,"Email"),n(),a(5,"div",4),S(6,"input",5),n(),c(7,Ne,2,1,"p",6),n(),c(8,Ve,9,11,"div",2),a(9,"div",2)(10,"label",7),s(11,"Fecha de registro"),n(),a(12,"div",4),S(13,"input",8),n(),c(14,De,2,1,"p",9),n(),a(15,"div",2)(16,"label",10),S(17,"input",11),s(18," Habilitado "),n()()()),e&2&&(l("form",i.form)("submitted",i.submitted)("maxDate",i.maxBirthDate()),o(),l("formGroup",i.form),o(5),l("ngClass",w(14,ce,i.fieldInvalid("email"))),R("aria-invalid",i.fieldInvalid("email"))("aria-describedby",i.fieldInvalid("email")?"email-error":null),o(),l("ngIf",i.fieldInvalid("email")),o(),ue(i.isEdit?-1:8),o(5),l("ngClass",w(16,ce,i.fieldInvalid("registrationDate"))),R("max",i.maxRegistrationDate)("aria-invalid",i.fieldInvalid("registrationDate"))("aria-describedby",i.fieldInvalid("registrationDate")?"registrationDate-error":null),o(),l("ngIf",i.fieldInvalid("registrationDate")))},dependencies:[E,V,x,z,q,be,D,T,L,k,Ce],encapsulation:2,changeDetection:0})};function K(r){return r.group({firstName:["",[u.required,u.minLength(2)]],lastName:["",[u.required,u.minLength(2)]],birthDate:["",[u.required,O.minAge(18)]],email:["",[u.required,u.email]],password:[""],registrationDate:["",[u.required,O.noFutureDate()]],enabled:[!0]})}var Te=r=>({"is-danger":r});function Le(r,t){if(r&1&&(a(0,"div",15),s(1),n()),r&2){let e=d();o(),v(e.error)}}function ke(r,t){if(r&1&&(a(0,"p",16),s(1),n()),r&2){let e=d();o(),g(" ",e.getError("positionInCSU")," ")}}var J=class r{constructor(t,e,i,m){this.fb=t;this.route=e;this.router=i;this.adminService=m}form;isEdit=!1;adminId;error=null;paths=_;submitted=!1;ngOnInit(){this.form=K(this.fb),this.form.addControl("positionInCSU",this.fb.control("",[u.required,u.minLength(2)]));let t=this.route.snapshot.paramMap.get("id");this.isEdit=!!t;let e=this.form.get("password");this.isEdit?(this.adminId=+t,e?.clearValidators(),e?.setValue(""),e?.updateValueAndValidity({emitEvent:!1}),this.loadAdmin()):(e?.setValidators([u.required,u.minLength(8),O.strongPassword()]),e?.updateValueAndValidity({emitEvent:!1}))}loadAdmin(){this.adminService.getById(this.adminId).subscribe({next:t=>{this.form.patchValue({firstName:t.firstName,lastName:t.lastName,birthDate:t.birthDate,email:t.email,password:"",registrationDate:t.registrationDate,enabled:t.enabled,positionInCSU:t.positionInCSU})},error:()=>{this.error="Error al cargar el administrador"}})}onSubmit(){if(this.submitted=!0,this.form.invalid){this.form.markAllAsTouched();return}let t=U({},this.form.value);this.isEdit&&!t.password&&delete t.password,(this.isEdit?this.adminService.update(this.adminId,t):this.adminService.create(t)).subscribe({next:()=>this.router.navigate([this.paths.Admin.Admins.List]),error:i=>{i.status===409?this.error="El email ya est\xE1 en uso":i.status===404?this.error="Administrador no encontrado":this.error="Error al guardar"}})}cancel(){this.router.navigate([this.paths.Admin.Admins.List])}fieldInvalid(t){let e=this.form.get(t);return!!e&&e.invalid&&(e.touched||e.dirty||this.submitted)}getError(t){let e=this.form.get(t);return!e||!e.errors?"":e.errors.required?"Este campo es obligatorio":e.errors.minlength?`M\xEDnimo ${e.errors.minlength.requiredLength} caracteres`:"Dato inv\xE1lido"}static \u0275fac=function(e){return new(e||r)(p(P),p(B),p(y),p(re))};static \u0275cmp=I({type:r,selectors:[["app-admin-form"]],decls:19,vars:14,consts:[[1,"section"],[1,"container"],[1,"title"],["class","notification is-danger",4,"ngIf"],["novalidate","",3,"ngSubmit","formGroup"],[3,"form","submitted","isEdit"],[1,"field"],["for","positionInCSU",1,"label"],[1,"control"],["id","positionInCSU","type","text","formControlName","positionInCSU",1,"input",3,"ngClass"],["id","positionInCSU-error","class","help is-danger",4,"ngIf"],[1,"field","mt-4"],[1,"buttons"],["type","submit",1,"button","is-primary",3,"disabled"],["type","button",1,"button","is-danger",3,"click"],[1,"notification","is-danger"],["id","positionInCSU-error",1,"help","is-danger"]],template:function(e,i){e&1&&(a(0,"section",0)(1,"div",1)(2,"h1",2),s(3),n(),c(4,Le,2,1,"div",3),a(5,"form",4),f("ngSubmit",function(){return i.onSubmit()}),S(6,"app-user-form-base",5),a(7,"div",6)(8,"label",7),s(9,"Cargo en CSU"),n(),a(10,"div",8),S(11,"input",9),n(),c(12,ke,2,1,"p",10),n(),a(13,"div",11)(14,"div",12)(15,"button",13),s(16),n(),a(17,"button",14),f("click",function(){return i.cancel()}),s(18,"Cancelar"),n()()()()()()),e&2&&(o(3),v(i.isEdit?"Editar administrador":"Nuevo administrador"),o(),l("ngIf",i.error),o(),l("formGroup",i.form),o(),l("form",i.form)("submitted",i.submitted)("isEdit",i.isEdit),o(5),l("ngClass",w(12,Te,i.fieldInvalid("positionInCSU"))),R("aria-invalid",i.fieldInvalid("positionInCSU"))("aria-describedby",i.fieldInvalid("positionInCSU")?"positionInCSU-error":null),o(),l("ngIf",i.fieldInvalid("positionInCSU")),o(3),l("disabled",i.form.invalid),o(),g(" ",i.isEdit?"Actualizar":"Crear"," "))},dependencies:[E,V,x,z,G,q,D,T,L,k,F,M],encapsulation:2})};function Me(r,t){r&1&&(a(0,"div"),s(1,"Cargando..."),n())}function Ue(r,t){if(r&1&&(a(0,"div",8),s(1),n()),r&2){let e=d();o(),v(e.error)}}function He(r,t){if(r&1){let e=N();a(0,"div",9)(1,"div",10)(2,"strong"),s(3),n(),a(4,"div",11)(5,"button",12),f("click",function(){let m=h(e).$implicit,C=d();return b(C.goToEdit(m.id))}),s(6,"Editar"),n(),a(7,"button",13),f("click",function(){let m=h(e).$implicit,C=d();return b(C.deleteUser(m.id))}),s(8,"Borrar"),n()()(),a(9,"p",14),s(10),n(),a(11,"p",14),s(12),n(),a(13,"p",14),s(14),n()()}if(r&2){let e=t.$implicit,i=d();o(3),H("",e.firstName," ",e.lastName,""),o(7),g("Email: ",e.email,""),o(2),g("Especialidad: ",i.specialtyLabel[e.specialty],""),o(2),g("Matr\xEDcula: ",e.license,"")}}function Be(r,t){r&1&&(a(0,"p",14),s(1," No se encontraron profesionales. "),n())}var le=class r{constructor(t,e){this.healthStaffService=t;this.router=e}healthStaff=[];loading=!0;error=null;paths=_;specialtyLabel={CLINIC:"Cl\xEDnica",PSYCHOLOGY:"Psicolog\xEDa",NURSING:"Enfermer\xEDa",SOCIAL_WORK:"Trabajo social",NUTRITION:"Nutrici\xF3n"};ngOnInit(){this.fetchHealthStaff()}fetchHealthStaff(){this.loading=!0,this.healthStaffService.getAll().subscribe({next:t=>{this.healthStaff=t.filter(e=>e.enabled),this.loading=!1},error:t=>{this.error="Error cargando personal de salud",this.loading=!1,console.error(t)}})}goToNew(){this.router.navigate([this.paths.Admin.HealthStaff.New])}goToEdit(t){this.router.navigate([this.paths.Admin.HealthStaff.Edit(t)])}deleteUser(t){confirm("\xBFSeguro que quer\xE9s eliminar este usuario?")&&this.healthStaffService.delete(t).subscribe({next:()=>this.fetchHealthStaff(),error:e=>{this.error="Error eliminando el usuario",console.error(e)}})}static \u0275fac=function(e){return new(e||r)(p(ne),p(y))};static \u0275cmp=I({type:r,selectors:[["app-health-staff-list"]],decls:10,vars:4,consts:[[1,"section"],[1,"container"],[1,"title"],[1,"button","is-primary","mb-4",3,"click"],[4,"ngIf"],["class","notification is-danger",4,"ngIf"],["class","box",4,"ngFor","ngForOf"],["class","has-text-grey",4,"ngIf"],[1,"notification","is-danger"],[1,"box"],[1,"is-flex","is-justify-content-space-between","is-align-items-center","mb-2"],[1,"buttons"],[1,"button","is-info","is-small",3,"click"],[1,"button","is-danger","is-small",3,"click"],[1,"has-text-grey"]],template:function(e,i){e&1&&(a(0,"section",0)(1,"div",1)(2,"h1",2),s(3,"Personal de Salud"),n(),a(4,"button",3),f("click",function(){return i.goToNew()}),s(5,"+ Nuevo profesional"),n(),c(6,Me,2,0,"div",4)(7,Ue,2,1,"div",5)(8,He,15,5,"div",6)(9,Be,2,0,"p",7),n()()),e&2&&(o(6),l("ngIf",i.loading),o(),l("ngIf",i.error),o(),l("ngForOf",i.healthStaff),o(),l("ngIf",!i.loading&&i.healthStaff.length===0))},dependencies:[E,A,x,F],encapsulation:2})};var Ie=r=>({"is-danger":r});function qe(r,t){if(r&1&&(a(0,"div",19),s(1),n()),r&2){let e=d();o(),v(e.error)}}function Ge(r,t){if(r&1&&(a(0,"option",20),s(1),n()),r&2){let e=t.$implicit;l("value",e.value),o(),v(e.label)}}function Pe(r,t){if(r&1&&(a(0,"p",21),s(1),n()),r&2){let e=d();o(),v(e.getError("specialty"))}}function je(r,t){if(r&1&&(a(0,"p",21),s(1),n()),r&2){let e=d();o(),v(e.getError("license"))}}var Q=class r{constructor(t,e,i,m){this.fb=t;this.route=e;this.router=i;this.healthStaffService=m}form;isEdit=!1;healthStaffId;error=null;submitted=!1;specialties=Se;ngOnInit(){this.form=K(this.fb),this.form.addControl("specialty",this.fb.control(null,[u.required])),this.form.addControl("license",this.fb.control("",[u.required]));let t=this.route.snapshot.paramMap.get("id");this.isEdit=!!t;let e=this.form.get("password");this.isEdit?(this.healthStaffId=+t,e?.clearValidators(),e?.setValue(""),e?.updateValueAndValidity({emitEvent:!1}),this.loadUser()):(e?.setValidators([u.required,u.minLength(8),O.strongPassword()]),e?.updateValueAndValidity({emitEvent:!1}))}loadUser(){this.healthStaffService.getById(this.healthStaffId).subscribe({next:t=>{this.form.patchValue(t)},error:()=>{this.error="Error al cargar el personal de salud"}})}onSubmit(){if(this.submitted=!0,this.form.invalid){this.form.markAllAsTouched();return}let t=Z(U({},this.form.value),{birthDate:this.formatDate(this.form.value.birthDate),registrationDate:this.formatDate(this.form.value.registrationDate)});this.isEdit&&!t.password&&delete t.password,(this.isEdit?this.healthStaffService.update(this.healthStaffId,t):this.healthStaffService.create(t)).subscribe({next:()=>this.router.navigate([_.Admin.HealthStaff.List]),error:i=>{if(i.status===409){let m=(typeof i.error=="string"?i.error:i.error?.message||"").toLowerCase();m.includes("email")?this.error="El email ya est\xE1 en uso":m.includes("license")?this.error="La matr\xEDcula ya est\xE1 en uso":this.error="Conflicto al guardar los datos"}else this.error="Error al guardar"}})}cancel(){this.router.navigate([_.Admin.HealthStaff.List])}formatDate(t){return t?new Date(t).toISOString().split("T")[0]:null}fieldInvalid(t){let e=this.form.get(t);return!!e&&e.invalid&&(e.touched||e.dirty||this.submitted)}getError(t){let e=this.form.get(t);return!e||!e.errors?"":e.errors.required?"Este campo es obligatorio":"Dato inv\xE1lido"}static \u0275fac=function(e){return new(e||r)(p(P),p(B),p(y),p(ne))};static \u0275cmp=I({type:r,selectors:[["app-health-staff-form"]],decls:29,vars:18,consts:[[1,"section"],[1,"container"],[1,"title"],["class","notification is-danger",4,"ngIf"],["novalidate","",3,"ngSubmit","formGroup"],[3,"form","submitted","isEdit"],[1,"field"],[1,"label"],[1,"control"],[1,"select","is-fullwidth",3,"ngClass"],["formControlName","specialty"],["disabled","",3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],["class","help is-danger",4,"ngIf"],["type","text","formControlName","license",1,"input",3,"ngClass"],[1,"field","mt-4"],[1,"buttons"],["type","submit",1,"button","is-primary",3,"disabled"],["type","button",1,"button","is-danger",3,"click"],[1,"notification","is-danger"],[3,"value"],[1,"help","is-danger"]],template:function(e,i){e&1&&(a(0,"section",0)(1,"div",1)(2,"h1",2),s(3),n(),c(4,qe,2,1,"div",3),a(5,"form",4),f("ngSubmit",function(){return i.onSubmit()}),S(6,"app-user-form-base",5),a(7,"div",6)(8,"label",7),s(9,"Especialidad"),n(),a(10,"div",8)(11,"div",9)(12,"select",10)(13,"option",11),s(14,"Seleccione una"),n(),c(15,Ge,2,2,"option",12),n()()(),c(16,Pe,2,1,"p",13),n(),a(17,"div",6)(18,"label",7),s(19,"Matr\xEDcula"),n(),a(20,"div",8),S(21,"input",14),n(),c(22,je,2,1,"p",13),n(),a(23,"div",15)(24,"div",16)(25,"button",17),s(26),n(),a(27,"button",18),f("click",function(){return i.cancel()}),s(28,"Cancelar"),n()()()()()()),e&2&&(o(3),v(i.isEdit?"Editar personal de salud":"Nuevo personal de salud"),o(),l("ngIf",i.error),o(),l("formGroup",i.form),o(),l("form",i.form)("submitted",i.submitted)("isEdit",i.isEdit),o(5),l("ngClass",w(14,Ie,i.fieldInvalid("specialty"))),o(2),l("ngValue",null),o(2),l("ngForOf",i.specialties),o(),l("ngIf",i.fieldInvalid("specialty")),o(5),l("ngClass",w(16,Ie,i.fieldInvalid("license"))),o(),l("ngIf",i.fieldInvalid("license")),o(3),l("disabled",i.form.invalid),o(),g(" ",i.isEdit?"Actualizar":"Crear"," "))},dependencies:[E,V,A,x,z,G,te,ie,q,ee,D,T,L,k,F,M],encapsulation:2})};function Ye(r,t){r&1&&(a(0,"div"),s(1,"Cargando..."),n())}function Ke(r,t){if(r&1&&(a(0,"div",8),s(1),n()),r&2){let e=d();o(),v(e.error)}}function We(r,t){if(r&1){let e=N();a(0,"div",9)(1,"div",10)(2,"strong"),s(3),n(),a(4,"div",11)(5,"button",12),f("click",function(){let m=h(e).$implicit,C=d();return b(C.goToEdit(m.id))}),s(6,"Editar"),n(),a(7,"button",13),f("click",function(){let m=h(e).$implicit,C=d();return b(C.deleteRepresentative(m.id))}),s(8,"Borrar"),n()()(),a(9,"p",14),s(10),n(),a(11,"p",14),s(12),n()()}if(r&2){let e=t.$implicit;o(3),H("",e.firstName," ",e.lastName,""),o(7),g("Email: ",e.email,""),o(2),g("Organizaci\xF3n: ",e.organizationName||"\u2014"," ")}}function Je(r,t){r&1&&(a(0,"p",14),s(1," No se encontraron representantes. "),n())}var me=class r{constructor(t,e){this.representativeService=t;this.router=e}representatives=[];loading=!0;error=null;paths=_;ngOnInit(){this.fetchRepresentatives()}fetchRepresentatives(){this.loading=!0,this.representativeService.getAll().subscribe({next:t=>{this.representatives=t.filter(e=>e.enabled),this.loading=!1},error:t=>{this.error="Error cargando representantes",this.loading=!1,console.error(t)}})}goToNew(){this.router.navigate([_.Admin.Representatives.New])}goToEdit(t){this.router.navigate([_.Admin.Representatives.Edit(t)])}deleteRepresentative(t){confirm("\xBFSeguro que quer\xE9s eliminar este representante?")&&this.representativeService.delete(t).subscribe({next:()=>this.fetchRepresentatives(),error:e=>{this.error="Error eliminando el representante",console.error(e)}})}static \u0275fac=function(e){return new(e||r)(p(oe),p(y))};static \u0275cmp=I({type:r,selectors:[["app-social-org-representative-list"]],decls:10,vars:4,consts:[[1,"section"],[1,"container"],[1,"title"],[1,"button","is-primary","mb-4",3,"click"],[4,"ngIf"],["class","notification is-danger",4,"ngIf"],["class","box",4,"ngFor","ngForOf"],["class","has-text-grey",4,"ngIf"],[1,"notification","is-danger"],[1,"box"],[1,"is-flex","is-justify-content-space-between","is-align-items-center","mb-2"],[1,"buttons"],[1,"button","is-info","is-small",3,"click"],[1,"button","is-danger","is-small",3,"click"],[1,"has-text-grey"]],template:function(e,i){e&1&&(a(0,"section",0)(1,"div",1)(2,"h1",2),s(3,"Representantes de organizaciones sociales"),n(),a(4,"button",3),f("click",function(){return i.goToNew()}),s(5,"+ Nuevo representante"),n(),c(6,Ye,2,0,"div",4)(7,Ke,2,1,"div",5)(8,We,13,4,"div",6)(9,Je,2,0,"p",7),n()()),e&2&&(o(6),l("ngIf",i.loading),o(),l("ngIf",i.error),o(),l("ngForOf",i.representatives),o(),l("ngIf",!i.loading&&i.representatives.length===0))},dependencies:[E,A,x,F],encapsulation:2})};var Qe=r=>({"is-danger":r});function Xe(r,t){if(r&1&&(a(0,"div",15),s(1),n()),r&2){let e=d();o(),v(e.error)}}function Ze(r,t){if(r&1&&(a(0,"option",20),s(1),n()),r&2){let e=t.$implicit;l("ngValue",e.id),o(),v(e.name)}}function et(r,t){if(r&1&&(a(0,"div",16)(1,"select",17)(2,"option",18),s(3,"Seleccionar organizaci\xF3n"),n(),c(4,Ze,2,2,"option",19),n()()),r&2){let e=d();o(),l("ngClass",w(5,Qe,e.fieldInvalid("organizationId"))),R("aria-invalid",e.fieldInvalid("organizationId"))("aria-describedby",e.fieldInvalid("organizationId")?"org-error":null),o(),l("ngValue",null),o(2),l("ngForOf",e.organizations)}}function tt(r,t){if(r&1&&(a(0,"p",21),s(1),n()),r&2){let e=d();o(),g(" ",e.getError("organizationId")," ")}}function it(r,t){r&1&&(a(0,"p",22),s(1,"Cargando organizaciones..."),n())}var X=class r{constructor(t,e,i,m,C){this.fb=t;this.route=e;this.router=i;this.representativeService=m;this.organizationService=C}form;isEdit=!1;representativeId;error=null;submitted=!1;paths=_;organizations=[];loadingOrganizations=!1;ngOnInit(){this.form=K(this.fb),this.form.addControl("organizationId",this.fb.control(null,[u.required]));let t=this.route.snapshot.paramMap.get("id");this.isEdit=!!t;let e=this.form.get("password");if(this.isEdit)this.representativeId=+t,e?.clearValidators(),e?.setValue(""),e?.updateValueAndValidity({emitEvent:!1}),this.loadRepresentative();else{e?.setValidators([u.required,u.minLength(8),O.strongPassword()]),e?.updateValueAndValidity({emitEvent:!1});let i=this.route.snapshot.queryParamMap.get("organizationId");i&&this.form.patchValue({organizationId:+i})}this.loadOrganizations()}loadOrganizations(){this.loadingOrganizations=!0,this.organizationService.getAll().subscribe({next:t=>{this.organizations=t.slice().sort((e,i)=>e.name.localeCompare(i.name)),this.loadingOrganizations=!1},error:()=>{this.loadingOrganizations=!1,this.error="Error cargando organizaciones"}})}loadRepresentative(){this.representativeService.getById(this.representativeId).subscribe({next:t=>{this.form.patchValue({firstName:t.firstName,lastName:t.lastName,birthDate:t.birthDate,email:t.email,password:"",registrationDate:t.registrationDate,enabled:t.enabled,organizationId:t.organizationId??null})},error:()=>{this.error="Error al cargar el representante"}})}onSubmit(){if(this.submitted=!0,this.form.invalid){this.form.markAllAsTouched();return}let t=this.form.value,e=Z(U({},t),{organizationId:t.organizationId!=null?Number(t.organizationId):null});this.isEdit&&!e.password&&delete e.password,(this.isEdit?this.representativeService.update(this.representativeId,e):this.representativeService.create(e)).subscribe({next:()=>this.router.navigate([this.paths.Admin.Representatives.List]),error:m=>{m.status===409?this.error="El email ya est\xE1 en uso":m.status===404?this.error="Organizaci\xF3n no encontrada":this.error="Error al guardar"}})}cancel(){this.router.navigate([this.paths.Admin.Representatives.List])}fieldInvalid(t){let e=this.form.get(t);return!!e&&e.invalid&&(e.touched||e.dirty||this.submitted)}getError(t){let e=this.form.get(t);return!e||!e.errors?"":e.errors.required?"Este campo es obligatorio":e.errors.email?"Email inv\xE1lido":e.errors.minlength?`M\xEDnimo ${e.errors.minlength.requiredLength} caracteres`:e.errors.weakPassword?"Debe incluir may\xFAscula, min\xFAscula y n\xFAmero":e.errors.futureDate?"La fecha no puede ser en el futuro":"Dato inv\xE1lido"}static \u0275fac=function(e){return new(e||r)(p(P),p(B),p(y),p(oe),p(_e))};static \u0275cmp=I({type:r,selectors:[["app-social-org-representative-form"]],decls:20,vars:11,consts:[["loadingOrgsTpl",""],[1,"section"],[1,"container"],[1,"title"],["class","notification is-danger",4,"ngIf"],["novalidate","",3,"ngSubmit","formGroup"],[3,"form","submitted","isEdit"],[1,"field"],[1,"label"],["class","select is-fullwidth",4,"ngIf","ngIfElse"],["id","org-error","class","help is-danger",4,"ngIf"],[1,"field","mt-4"],[1,"buttons"],["type","submit",1,"button","is-primary",3,"disabled"],["type","button",1,"button","is-danger",3,"click"],[1,"notification","is-danger"],[1,"select","is-fullwidth"],["formControlName","organizationId",3,"ngClass"],["disabled","",3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"],["id","org-error",1,"help","is-danger"],[1,"has-text-grey"]],template:function(e,i){if(e&1){let m=N();a(0,"section",1)(1,"div",2)(2,"h1",3),s(3),n(),c(4,Xe,2,1,"div",4),a(5,"form",5),f("ngSubmit",function(){return h(m),b(i.onSubmit())}),S(6,"app-user-form-base",6),a(7,"div",7)(8,"label",8),s(9,"Organizaci\xF3n"),n(),c(10,et,5,7,"div",9)(11,tt,2,1,"p",10)(12,it,2,0,"ng-template",null,0,ve),n(),a(14,"div",11)(15,"div",12)(16,"button",13),s(17),n(),a(18,"button",14),f("click",function(){return h(m),b(i.cancel())}),s(19,"Cancelar"),n()()()()()()}if(e&2){let m=ge(13);o(3),v(i.isEdit?"Editar representante":"Nuevo representante"),o(),l("ngIf",i.error),o(),l("formGroup",i.form),o(),l("form",i.form)("submitted",i.submitted)("isEdit",i.isEdit),o(4),l("ngIf",!i.loadingOrganizations)("ngIfElse",m),o(),l("ngIf",i.fieldInvalid("organizationId")),o(5),l("disabled",i.form.invalid),o(),g(" ",i.isEdit?"Actualizar":"Crear"," ")}},dependencies:[E,V,A,x,z,G,te,ie,ee,D,T,L,k,F,M],encapsulation:2})};var Ei=[{path:"",redirectTo:"admins",pathMatch:"full"},{path:"admins",component:se},{path:"admins/new",component:J},{path:"admins/:id/edit",component:J},{path:"health-staff",component:le},{path:"health-staff/new",component:Q},{path:"health-staff/:id/edit",component:Q},{path:"representatives",component:me},{path:"representatives/new",component:X},{path:"representatives/:id/edit",component:X}];export{Ei as adminUsersRoutes};
