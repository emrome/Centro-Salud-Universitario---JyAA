import{a as A}from"./chunk-NPOWM4MR.js";import{b as L,c as T,d as D,e as N,g as F,i as O,j as w,p as P,r as k}from"./chunk-4ZEEV3KU.js";import{$a as c,Ea as E,Ja as d,Ob as b,Pb as I,Qa as p,Rb as q,Sb as y,Ua as n,Va as i,W as x,Wa as C,X as h,Za as S,_a as R,hb as s,ib as u,jb as m,sb as g,ua as o,ub as _,ya as v}from"./chunk-ILAX3XGE.js";import"./chunk-FDERIQAA.js";function G(t,r){if(t&1&&(n(0,"div",20),s(1),i()),t&2){let e=c();o(),u(e.error)}}function M(t,r){if(t&1&&(n(0,"div",21),s(1),i()),t&2){let e=c();o(),u(e.success)}}function V(t,r){t&1&&(n(0,"p",22),s(1,"Requerido"),i())}function j(t,r){t&1&&(n(0,"div"),s(1,"Cargando solicitudes..."),i())}function $(t,r){if(t&1&&(n(0,"div",23)(1,"div",24)(2,"div")(3,"p",25),s(4),i(),n(5,"p",26),s(6),g(7,"date"),i(),n(8,"p",27),s(9),i()(),n(10,"span",28),s(11,"PENDIENTE"),i()()()),t&2){let e=r.$implicit;o(4),m("Solicitud #",e.id,""),o(2),m("Creada: ",_(7,3,e.createdAt,"short"),""),o(3),u(e.description)}}function U(t,r){t&1&&(n(0,"p",29),s(1,"No hay solicitudes pendientes."),i())}function z(t,r){if(t&1&&(n(0,"p",26),s(1),i()),t&2){let e=c().$implicit;o(),m("Resuelta por: ",e.resolvedByName,"")}}function H(t,r){if(t&1){let e=S();n(0,"button",35),R("click",function(){x(e);let l=c().$implicit,B=c();return h(B.download(l.reportId))}),s(1," Descargar PDF "),i()}}function J(t,r){t&1&&(n(0,"span",36),s(1,"COMPLETADA"),i())}function Z(t,r){t&1&&(n(0,"span",37),s(1,"RECHAZADA"),i())}function K(t,r){if(t&1&&(n(0,"div",23)(1,"div",24)(2,"div")(3,"p",25),s(4),i(),d(5,z,2,1,"p",30),n(6,"p",26),s(7),g(8,"date"),i(),n(9,"p",27),s(10),i()(),n(11,"div",31),d(12,H,2,0,"button",32)(13,J,2,0,"span",33)(14,Z,2,0,"span",34),i()()()),t&2){let e=r.$implicit;o(4),m("Solicitud #",e.id,""),o(),p("ngIf",e.resolvedByName),o(2),m("Resuelta: ",_(8,7,e.resolvedAt,"shortDate"),""),o(3),u(e.description),o(2),p("ngIf",e.status==="COMPLETED"&&e.reportId),o(),p("ngIf",e.status==="COMPLETED"),o(),p("ngIf",e.status==="REJECTED")}}function Q(t,r){t&1&&(n(0,"p",29),s(1,"Sin solicitudes resueltas."),i())}var f=class t{constructor(r,e){this.fb=r;this.service=e}form;loading=!1;error=null;success=null;pending=[];completed=[];ngOnInit(){this.form=this.fb.group({description:["",T.required]}),this.fetch()}fetch(){this.loading=!0,this.error=null,this.service.getByRequesterMe().subscribe({next:r=>{this.pending=r.filter(e=>e.status==="PENDING"),this.completed=r.filter(e=>e.status!=="PENDING"),this.loading=!1},error:()=>{this.error="Error cargando solicitudes",this.loading=!1}})}onSubmit(){if(this.form.invalid)return;let r={description:this.form.value.description};this.success=null,this.error=null,this.service.create(r).subscribe({next:()=>{this.success="Solicitud creada",this.form.reset(),this.fetch()},error:()=>{this.error="Error creando solicitud"}})}download(r){r&&this.service.downloadCompletedReportFile(r).subscribe({next:e=>{let a=URL.createObjectURL(e),l=document.createElement("a");l.href=a,l.download=`reporte_${r}.pdf`,l.click(),URL.revokeObjectURL(a)},error:()=>{this.error="Error descargando archivo"}})}static \u0275fac=function(e){return new(e||t)(v(P),v(A))};static \u0275cmp=E({type:t,selectors:[["app-report-request-list-rep"]],decls:29,vars:10,consts:[[1,"section"],[1,"container"],[1,"title","has-text-centered"],["class","notification is-danger",4,"ngIf"],["class","notification is-success",4,"ngIf"],[1,"card","mb-5",3,"ngSubmit","formGroup"],[1,"card-content"],[1,"field"],[1,"label"],[1,"control"],["formControlName","description","placeholder","Describe el reporte",1,"textarea"],["class","help is-danger",4,"ngIf"],[1,"field","has-text-centered","mt-4"],["type","submit",1,"button","is-primary",3,"disabled"],[4,"ngIf"],[1,"columns"],[1,"column"],[1,"subtitle"],["class","box",4,"ngFor","ngForOf"],["class","has-text-grey",4,"ngIf"],[1,"notification","is-danger"],[1,"notification","is-success"],[1,"help","is-danger"],[1,"box"],[1,"is-flex","is-justify-content-space-between","is-align-items-center"],[1,"has-text-weight-semibold"],[1,"is-size-7","has-text-grey"],[1,"mt-2"],[1,"tag","is-warning"],[1,"has-text-grey"],["class","is-size-7 has-text-grey",4,"ngIf"],[1,"has-text-right"],["class","button is-link is-light",3,"click",4,"ngIf"],["class","tag is-success ml-2",4,"ngIf"],["class","tag is-danger ml-2",4,"ngIf"],[1,"button","is-link","is-light",3,"click"],[1,"tag","is-success","ml-2"],[1,"tag","is-danger","ml-2"]],template:function(e,a){if(e&1&&(n(0,"section",0)(1,"div",1)(2,"h1",2),s(3,"Solicitudes de reporte"),i(),d(4,G,2,1,"div",3)(5,M,2,1,"div",4),n(6,"form",5),R("ngSubmit",function(){return a.onSubmit()}),n(7,"div",6)(8,"div",7)(9,"label",8),s(10,"Descripci\xF3n del pedido"),i(),n(11,"div",9),C(12,"textarea",10),i(),d(13,V,2,0,"p",11),i(),n(14,"div",12)(15,"button",13),s(16," Crear solicitud "),i()()()(),d(17,j,2,0,"div",14),n(18,"div",15)(19,"div",16)(20,"h2",17),s(21,"Pendientes"),i(),d(22,$,12,6,"div",18)(23,U,2,0,"p",19),i(),n(24,"div",16)(25,"h2",17),s(26,"Resueltas / Rechazadas"),i(),d(27,K,15,10,"div",18)(28,Q,2,0,"p",19),i()()()()),e&2){let l;o(4),p("ngIf",a.error),o(),p("ngIf",a.success),o(),p("formGroup",a.form),o(7),p("ngIf",((l=a.form.get("description"))==null?null:l.invalid)&&((l=a.form.get("description"))==null?null:l.touched)),o(2),p("disabled",a.form.invalid||a.loading),o(2),p("ngIf",a.loading),o(5),p("ngForOf",a.pending),o(),p("ngIf",!a.loading&&a.pending.length===0),o(4),p("ngForOf",a.completed),o(),p("ngIf",!a.loading&&a.completed.length===0)}},dependencies:[y,b,I,q,k,F,L,D,N,O,w],encapsulation:2})};var pe=[{path:"",component:f}];export{pe as representativeReportRequestRoutes};
