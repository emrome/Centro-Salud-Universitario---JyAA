import{a as V}from"./chunk-NPOWM4MR.js";import{a as P,b as N,c as y,d as j,e as M,g as O,i as w,j as B,p as A,r as $}from"./chunk-4ZEEV3KU.js";import{$a as c,Ea as F,Ja as u,Ob as I,Pb as H,Qa as s,Rb as k,Sa as x,Sb as L,Ua as r,Va as n,W as h,Wa as m,X as v,Xa as R,Ya as b,Za as q,_a as f,hb as a,ib as g,jb as d,sb as E,ua as o,ub as T,ya as S}from"./chunk-ILAX3XGE.js";import"./chunk-FDERIQAA.js";function z(t,i){if(t&1&&(r(0,"div",11),a(1),n()),t&2){let e=c();o(),g(e.error)}}function G(t,i){if(t&1&&(r(0,"div",12),a(1),n()),t&2){let e=c();o(),g(e.success)}}function U(t,i){t&1&&(r(0,"div"),a(1,"Cargando..."),n())}function W(t,i){if(t&1&&(r(0,"p",45),a(1),n()),t&2){let e=c().$implicit;o(),d("Solicitante: ",e.requesterName,"")}}function Z(t,i){if(t&1){let e=q();r(0,"div",15)(1,"div",16)(2,"p",17),a(3),n(),u(4,W,2,1,"p",18),r(5,"p",19),a(6),n()(),r(7,"div",20)(8,"div",21)(9,"label",22),a(10,"Archivo"),n(),r(11,"div",23)(12,"label",24)(13,"input",25),f("change",function(p){let _=h(e).$implicit,D=c(2);return v(D.onPickFile(p,_.id))}),n(),r(14,"span",26)(15,"span",27),m(16,"i",28),n(),r(17,"span",24),a(18,"Elegir archivo"),n()(),r(19,"span",29),a(20),n()()()(),r(21,"form",30)(22,"div",31)(23,"div",32)(24,"label",22),a(25,"Nombre del reporte"),n(),m(26,"input",33),n()(),r(27,"div",21)(28,"label",22),a(29,"Descripci\xF3n"),n(),m(30,"textarea",34),n(),r(31,"div",35)(32,"label",36),m(33,"input",37),a(34," P\xFAblico (visible en Home) "),n(),r(35,"p",38),a(36,"Si est\xE1 marcado, el reporte aparecer\xE1 en la p\xE1gina de inicio."),n()(),r(37,"div",39)(38,"button",40),f("click",function(){let p=h(e).$implicit,_=c(2);return v(_.complete(p))}),r(39,"span",41),m(40,"i",42),n(),r(41,"span"),a(42,"Completar"),n()(),r(43,"button",43),f("click",function(){let p=h(e).$implicit,_=c(2);return v(_.reject(p))}),r(44,"span",41),m(45,"i",44),n(),r(46,"span"),a(47,"Rechazar"),n()()()()()()}if(t&2){let e=i.$implicit,l=c(2);o(3),d("Solicitud #",e.id,""),o(),s("ngIf",e.requesterName),o(2),d("Descripci\xF3n: ",e.description,""),o(14),g((l.fileMap[e.id]==null?null:l.fileMap[e.id].name)||"Ning\xFAn archivo seleccionado"),o(),s("formGroup",l.completeForm)}}function J(t,i){t&1&&(r(0,"p",46),a(1,"Sin pendientes."),n())}function K(t,i){if(t&1&&(R(0),u(1,Z,48,5,"div",13)(2,J,2,0,"p",14),b()),t&2){let e=c();o(),s("ngForOf",e.pending)("ngForTrackBy",e.trackByRequestId),o(),s("ngIf",!e.loading&&e.pending.length===0)}}function Q(t,i){if(t&1&&(r(0,"p",45),a(1),n()),t&2){let e=c().$implicit;o(),d("Solicitante: ",e.requesterName,"")}}function X(t,i){if(t&1&&(r(0,"p",45),a(1),n()),t&2){let e=c().$implicit;o(),d("Resuelto por: ",e.resolvedByName,"")}}function Y(t,i){if(t&1){let e=q();r(0,"button",52),f("click",function(){h(e);let p=c().$implicit,_=c(2);return v(_.download(p.reportId))}),r(1,"span",41),m(2,"i",53),n(),r(3,"span"),a(4,"Descargar PDF"),n()()}}function ee(t,i){if(t&1&&(r(0,"div",48)(1,"div",16)(2,"p",17),a(3),n(),u(4,Q,2,1,"p",18)(5,X,2,1,"p",18),r(6,"p",45),a(7),E(8,"date"),n(),r(9,"p",19),a(10),n()(),r(11,"div",49)(12,"div")(13,"span",50),a(14,"COMPLETADA"),n(),u(15,Y,5,0,"button",51),n()()()),t&2){let e=i.$implicit;o(3),d("Solicitud #",e.id,""),o(),s("ngIf",e.requesterName),o(),s("ngIf",e.resolvedByName),o(2),d("Resuelto: ",T(8,6,e.resolvedAt,"short"),""),o(3),g(e.description),o(5),s("ngIf",e.reportId)}}function te(t,i){t&1&&(r(0,"p",46),a(1,"Sin resueltas."),n())}function ie(t,i){if(t&1&&(R(0),u(1,ee,16,9,"div",47)(2,te,2,0,"p",14),b()),t&2){let e=c();o(),s("ngForOf",e.resolved)("ngForTrackBy",e.trackByRequestId),o(),s("ngIf",!e.loading&&e.resolved.length===0)}}function ne(t,i){if(t&1&&(r(0,"p",45),a(1),n()),t&2){let e=c().$implicit;o(),d("Solicitante: ",e.requesterName,"")}}function re(t,i){if(t&1&&(r(0,"p",45),a(1),n()),t&2){let e=c().$implicit;o(),d("Rechazado por: ",e.resolvedByName,"")}}function oe(t,i){if(t&1&&(r(0,"div",55)(1,"div",16)(2,"p",17),a(3),n(),u(4,ne,2,1,"p",18)(5,re,2,1,"p",18),r(6,"p",45),a(7),E(8,"date"),n(),r(9,"p",19),a(10),n()(),r(11,"div",20)(12,"span",56),a(13,"RECHAZADA"),n()()()),t&2){let e=i.$implicit;o(3),d("Solicitud #",e.id,""),o(),s("ngIf",e.requesterName),o(),s("ngIf",e.resolvedByName),o(2),d("Resuelta: ",T(8,5,e.resolvedAt,"shortDate"),""),o(3),g(e.description)}}function ae(t,i){t&1&&(r(0,"p",46),a(1,"Sin rechazadas."),n())}function le(t,i){if(t&1&&(R(0),u(1,oe,14,8,"div",54)(2,ae,2,0,"p",14),b()),t&2){let e=c();o(),s("ngForOf",e.rejected)("ngForTrackBy",e.trackByRequestId),o(),s("ngIf",!e.loading&&e.rejected.length===0)}}var C=class t{constructor(i,e){this.service=i;this.fb=e}currentTab="pending";pending=[];resolved=[];rejected=[];loading=!1;error=null;success=null;completeForm;fileMap={};ngOnInit(){this.completeForm=this.fb.group({name:this.fb.control("",{nonNullable:!0,validators:[y.required]}),description:this.fb.control("",{nonNullable:!0,validators:[y.required]}),visibleToAllHealthStaff:this.fb.control(!0,{nonNullable:!0}),isPublic:this.fb.control(!1,{nonNullable:!0})}),this.fetchPending()}setTab(i){this.currentTab=i,i==="pending"&&this.pending.length===0&&this.fetchPending(),i==="resolved"&&this.resolved.length===0&&this.fetchResolved(),i==="rejected"&&this.rejected.length===0&&this.fetchRejected()}fetchPending(){this.loading=!0,this.error=null,this.service.getPendingForHealth().subscribe({next:i=>{this.pending=i,this.loading=!1},error:()=>{this.error="Error cargando pendientes",this.loading=!1}})}fetchResolved(){this.loading=!0,this.error=null,this.service.getResolvedForHealth().subscribe({next:i=>{this.resolved=i,this.loading=!1},error:()=>{this.error="Error cargando resueltas",this.loading=!1}})}fetchRejected(){this.loading=!0,this.error=null,this.service.getRejectedForHealth().subscribe({next:i=>{this.rejected=i,this.loading=!1},error:()=>{this.error="Error cargando rechazadas",this.loading=!1}})}onPickFile(i,e){let l=i.target,p=l.files&&l.files.length?l.files[0]:null;this.fileMap[e]=p}complete(i){let e=this.fileMap[i.id];if(!e){this.error="Seleccion\xE1 un archivo";return}if(this.completeForm.invalid){this.error="Complet\xE1 nombre y descripci\xF3n";return}this.success=null,this.error=null,this.service.completeWithReport(i.id,{name:this.completeForm.controls.name.value,description:this.completeForm.controls.description.value,visibleToAllHealthStaff:this.completeForm.controls.visibleToAllHealthStaff.value,isPublic:this.completeForm.controls.isPublic.value,file:e}).subscribe({next:()=>{this.success=`Solicitud #${i.id} completada`,this.fileMap[i.id]=null,this.completeForm.reset({name:"",description:"",visibleToAllHealthStaff:!0,isPublic:!1}),this.fetchPending()},error:()=>{this.error="Error completando la solicitud"}})}reject(i){let e=prompt("Motivo del rechazo:")||void 0;this.success=null,this.error=null,this.service.reject(i.id,e).subscribe({next:()=>{this.success=`Solicitud #${i.id} rechazada`,this.fetchPending()},error:()=>{this.error="Error rechazando la solicitud"}})}download(i){i&&this.service.downloadCompletedReportFile(i).subscribe({next:e=>{let l=URL.createObjectURL(e),p=document.createElement("a");p.href=l,p.download=`reporte_${i}.pdf`,p.click(),URL.revokeObjectURL(l)},error:()=>{this.error="Error descargando archivo"}})}trackByRequestId=(i,e)=>e.id??i;static \u0275fac=function(e){return new(e||t)(S(V),S(A))};static \u0275cmp=F({type:t,selectors:[["app-health-report-request-list"]],decls:24,vars:12,consts:[[1,"section"],[1,"container"],[1,"title","has-text-centered"],[1,"tabs","is-boxed","is-centered","tabs-spaced"],[3,"click"],[1,"fas","fa-inbox","mr-2"],[1,"fas","fa-check-circle","mr-2"],[1,"fas","fa-times-circle","mr-2"],["class","notification is-danger",4,"ngIf"],["class","notification is-success",4,"ngIf"],[4,"ngIf"],[1,"notification","is-danger"],[1,"notification","is-success"],["class","request-card",4,"ngFor","ngForOf","ngForTrackBy"],["class","has-text-grey has-text-centered",4,"ngIf"],[1,"request-card"],[1,"request-meta"],[1,"request-id"],["class","is-size-7 has-text-grey",4,"ngIf"],[1,"mt-2"],[1,"request-actions"],[1,"field"],[1,"label"],[1,"file","has-name","is-fullwidth"],[1,"file-label"],["type","file","accept","application/pdf,image/png,image/jpeg",1,"file-input",3,"change"],[1,"file-cta"],[1,"file-icon"],[1,"fas","fa-upload"],[1,"file-name"],[1,"mt-3",3,"formGroup"],[1,"columns"],[1,"column"],["type","text","formControlName","name",1,"input"],["formControlName","description",1,"textarea"],[1,"field","mt-2"],[1,"checkbox"],["type","checkbox","formControlName","isPublic"],[1,"help","is-info"],[1,"buttons","mt-2"],["type","button",1,"button","is-success",3,"click"],[1,"icon"],[1,"fas","fa-paper-plane"],["type","button",1,"button","is-danger","is-light",3,"click"],[1,"fas","fa-ban"],[1,"is-size-7","has-text-grey"],[1,"has-text-grey","has-text-centered"],["class","request-card is-resolved",4,"ngFor","ngForOf","ngForTrackBy"],[1,"request-card","is-resolved"],[1,"request-actions","resolved-actions"],[1,"tag","is-success","mr-2"],["class","button is-link is-light",3,"click",4,"ngIf"],[1,"button","is-link","is-light",3,"click"],[1,"fas","fa-file-download"],["class","request-card is-rejected",4,"ngFor","ngForOf","ngForTrackBy"],[1,"request-card","is-rejected"],[1,"tag","is-danger"]],template:function(e,l){e&1&&(r(0,"section",0)(1,"div",1)(2,"h1",2),a(3,"Solicitudes"),n(),r(4,"div",3)(5,"ul")(6,"li")(7,"a",4),f("click",function(){return l.setTab("pending")}),m(8,"i",5),a(9,"Pendientes"),n()(),r(10,"li")(11,"a",4),f("click",function(){return l.setTab("resolved")}),m(12,"i",6),a(13,"Resueltas"),n()(),r(14,"li")(15,"a",4),f("click",function(){return l.setTab("rejected")}),m(16,"i",7),a(17,"Rechazadas"),n()()()(),u(18,z,2,1,"div",8)(19,G,2,1,"div",9)(20,U,2,0,"div",10)(21,K,3,3,"ng-container",10)(22,ie,3,3,"ng-container",10)(23,le,3,3,"ng-container",10),n()()),e&2&&(o(6),x("is-active",l.currentTab==="pending"),o(4),x("is-active",l.currentTab==="resolved"),o(4),x("is-active",l.currentTab==="rejected"),o(4),s("ngIf",l.error),o(),s("ngIf",l.success),o(),s("ngIf",l.loading),o(),s("ngIf",l.currentTab==="pending"),o(),s("ngIf",l.currentTab==="resolved"),o(),s("ngIf",l.currentTab==="rejected"))},dependencies:[L,I,H,k,$,O,N,P,j,M,w,B],styles:[".request-card[_ngcontent-%COMP%]{display:grid;grid-template-columns:1.2fr 1fr;gap:1.25rem;padding:1rem 1.25rem;margin-bottom:1rem;background:#fff;border-radius:10px;box-shadow:0 6px 18px #0000000f;border:1px solid rgba(0,0,0,.06)}.request-card.is-resolved[_ngcontent-%COMP%]{border-left:4px solid #48c78e}.request-card.is-rejected[_ngcontent-%COMP%]{border-left:4px solid #f14668}.request-meta[_ngcontent-%COMP%]   .request-id[_ngcontent-%COMP%]{font-weight:700;font-size:1.05rem;margin-bottom:.25rem}.request-actions[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%] + .button[_ngcontent-%COMP%]{margin-left:.5rem}.tabs-spaced[_ngcontent-%COMP%]{margin-bottom:1.25rem}@media (max-width: 1023px){.request-card[_ngcontent-%COMP%]{grid-template-columns:1fr}.resolved-actions[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start}}"]})};var Re=[{path:"",component:C}];export{Re as healthStaffReportRequestRoutes};
